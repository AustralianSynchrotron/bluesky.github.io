**UB** : Save and Restore Crystal Orientation
=============================================

see: https://github.com/bluesky/hklpy/issues/50

**Objectives**

1. Save the information defining the crystal orientation into the
   descriptor document
2. List runs that have orientation that can be restored
3. Restore crystal orientation from a given Bluesky run

--------------

Data collection
===============

Setup for data collection
-------------------------

Use a local, temporary, file-based databroker. It will reset after each
restart of the notebook. Prepare to define the diffractometers needed
here plus some items from the ophyd simulators.

.. code:: ipython3

    import gi
    gi.require_version('Hkl', '5.0')
    
    from bluesky import RunEngine
    from bluesky.callbacks.best_effort import BestEffortCallback
    import bluesky.plans as bp
    import bluesky.plan_stubs as bps
    import bluesky.preprocessors as bpp
    import databroker
    import hkl
    from hkl.calc import A_KEV
    from hkl.diffract import Constraint
    from hkl.util import Lattice, run_orientation_info, list_orientation_runs
    from hkl.geometries import *
    import numpy as np
    import pyRestTable
    from ophyd import Component, Device, EpicsSignal, Signal
    from ophyd.signal import AttributeSignal, ArrayAttributeSignal
    from ophyd.sim import *
    import pandas as pd
    
    bec = BestEffortCallback()
    bec.disable_plots()
    cat = databroker.temp().v2
    
    RE = RunEngine({})
    RE.subscribe(bec)
    RE.subscribe(cat.v1.insert)
    RE.md["notebook"] = "tst_UB_in_descriptor_document"
    RE.md["objective"] = "Demonstrate UB matrix save & restore in descriptor document of bluesky run"

--------------

Build simulated 4-circle diffractometer
---------------------------------------

Build two 4-circles so that we can test routines that differentiate
between similar diffractometers. Use the second one to restore
orientation saved from the first.

.. code:: ipython3

    class Fourc(SimulatedE4CV):
        pass
    
    fourc = Fourc("", name="fourc")
    fourc.energy.put(A_KEV / 1.54)
    a0 = 5.4310196
    fourc.calc.new_sample("silicon", lattice=(a0, a0, a0, 90, 90, 90))
    fourc.calc.sample.compute_UB(
        fourc.calc.sample.add_reflection(4, 0, 0, (-145.451, 0, 0, 69.0966)),
        fourc.calc.sample.add_reflection(0, 4, 0, (-145.451, 0, 90, 69.0966))
    )
    fourc.pa()
    
    orange = Fourc("", name="orange")
    orange.pa()


.. parsed-literal::

    ===================== ===========================================================================
    term                  value                                                                      
    ===================== ===========================================================================
    diffractometer        fourc                                                                      
    geometry              E4CV                                                                       
    class                 Fourc                                                                      
    energy (keV)          8.05092                                                                    
    wavelength (angstrom) 1.54000                                                                    
    calc engine           hkl                                                                        
    mode                  bissector                                                                  
    positions             ===== =======                                                              
                          name  value                                                                
                          ===== =======                                                              
                          omega 0.00000                                                              
                          chi   0.00000                                                              
                          phi   0.00000                                                              
                          tth   0.00000                                                              
                          ===== =======                                                              
    constraints           ===== ========= ========== ===== ====                                      
                          axis  low_limit high_limit value fit                                       
                          ===== ========= ========== ===== ====                                      
                          omega -180.0    180.0      0.0   True                                      
                          chi   -180.0    180.0      0.0   True                                      
                          phi   -180.0    180.0      0.0   True                                      
                          tth   -180.0    180.0      0.0   True                                      
                          ===== ========= ========== ===== ====                                      
    sample: silicon       ================= =========================================================
                          term              value                                                    
                          ================= =========================================================
                          unit cell edges   a=5.4310196, b=5.4310196, c=5.4310196                    
                          unit cell angles  alpha=90.0, beta=90.0, gamma=90.0                        
                          ref 1 (hkl)       h=4.0, k=0.0, l=0.0                                      
                          ref 1 positioners omega=-145.45100, chi=0.00000, phi=0.00000, tth=69.09660 
                          ref 2 (hkl)       h=0.0, k=4.0, l=0.0                                      
                          ref 2 positioners omega=-145.45100, chi=0.00000, phi=90.00000, tth=69.09660
                          [U]               [[-1.22173048e-05 -1.00000000e+00  0.00000000e+00]       
                                             [ 0.00000000e+00  0.00000000e+00  1.00000000e+00]       
                                             [-1.00000000e+00  1.22173048e-05  0.00000000e+00]]      
                          [UB]              [[-1.41342870e-05 -1.15690713e+00  7.08409963e-17]       
                                             [ 0.00000000e+00  0.00000000e+00  1.15690713e+00]       
                                             [-1.15690713e+00  1.41342870e-05  7.08392653e-17]]      
                          ================= =========================================================
    ===================== ===========================================================================
    
    ===================== ====================================================================
    term                  value                                                               
    ===================== ====================================================================
    diffractometer        orange                                                              
    geometry              E4CV                                                                
    class                 Fourc                                                               
    energy (keV)          8.05092                                                             
    wavelength (angstrom) 1.54000                                                             
    calc engine           hkl                                                                 
    mode                  bissector                                                           
    positions             ===== =======                                                       
                          name  value                                                         
                          ===== =======                                                       
                          omega 0.00000                                                       
                          chi   0.00000                                                       
                          phi   0.00000                                                       
                          tth   0.00000                                                       
                          ===== =======                                                       
    constraints           ===== ========= ========== ===== ====                               
                          axis  low_limit high_limit value fit                                
                          ===== ========= ========== ===== ====                               
                          omega -180.0    180.0      0.0   True                               
                          chi   -180.0    180.0      0.0   True                               
                          phi   -180.0    180.0      0.0   True                               
                          tth   -180.0    180.0      0.0   True                               
                          ===== ========= ========== ===== ====                               
    sample: main          ================ ===================================================
                          term             value                                              
                          ================ ===================================================
                          unit cell edges  a=1.54, b=1.54, c=1.54                             
                          unit cell angles alpha=90.0, beta=90.0, gamma=90.0                  
                          [U]              [[1. 0. 0.]                                        
                                            [0. 1. 0.]                                        
                                            [0. 0. 1.]]                                       
                          [UB]             [[ 4.07999046e+00 -2.49827363e-16 -2.49827363e-16] 
                                            [ 0.00000000e+00  4.07999046e+00 -2.49827363e-16] 
                                            [ 0.00000000e+00  0.00000000e+00  4.07999046e+00]]
                          ================ ===================================================
    ===================== ====================================================================
    




.. parsed-literal::

    <pyRestTable.rest_table.Table at 0x7fe3a3fd34c0>



Build simulators for other diffractometer geometries to test code that
differentiates between various possibile sources for restore of
orientation information.

.. code:: ipython3

    class Kappa(SimulatedK4CV):
        pass
    
    kappa = Kappa("", name="kappa")
    kappa.energy.put(A_KEV / 1.54)
    a0 = 5.4310196
    kappa.calc.new_sample("silicon", lattice=(a0, a0, a0, 90, 90, 90))
    kappa.calc.sample.compute_UB(
        kappa.calc.sample.add_reflection(4, 0, 0, (55.4507, 0, 90, -69.0966)), 
        kappa.calc.sample.add_reflection(0, 4, 0, (-1.5950, 134.7568, 123.3554, -69.0966))
    )
    kappa.pa()


.. parsed-literal::

    ===================== =================================================================================
    term                  value                                                                            
    ===================== =================================================================================
    diffractometer        kappa                                                                            
    geometry              K4CV                                                                             
    class                 Kappa                                                                            
    energy (keV)          8.05092                                                                          
    wavelength (angstrom) 1.54000                                                                          
    calc engine           hkl                                                                              
    mode                  bissector                                                                        
    positions             ====== =======                                                                   
                          name   value                                                                     
                          ====== =======                                                                   
                          komega 0.00000                                                                   
                          kappa  0.00000                                                                   
                          kphi   0.00000                                                                   
                          tth    0.00000                                                                   
                          ====== =======                                                                   
    constraints           ====== ========= ========== ===== ====                                           
                          axis   low_limit high_limit value fit                                            
                          ====== ========= ========== ===== ====                                           
                          komega -180.0    180.0      0.0   True                                           
                          kappa  -180.0    180.0      0.0   True                                           
                          kphi   -180.0    180.0      0.0   True                                           
                          tth    -180.0    180.0      0.0   True                                           
                          ====== ========= ========== ===== ====                                           
    sample: silicon       ================= ===============================================================
                          term              value                                                          
                          ================= ===============================================================
                          unit cell edges   a=5.4310196, b=5.4310196, c=5.4310196                          
                          unit cell angles  alpha=90.0, beta=90.0, gamma=90.0                              
                          ref 1 (hkl)       h=4.0, k=0.0, l=0.0                                            
                          ref 1 positioners komega=55.45070, kappa=0.00000, kphi=90.00000, tth=-69.09660   
                          ref 2 (hkl)       h=0.0, k=4.0, l=0.0                                            
                          ref 2 positioners komega=-1.59500, kappa=134.75680, kphi=123.35540, tth=-69.09660
                          [U]               [[-1.74532925e-05 -6.22695871e-06  1.00000000e+00]             
                                             [ 0.00000000e+00 -1.00000000e+00 -6.22695872e-06]             
                                             [ 1.00000000e+00 -1.08680932e-10  1.74532925e-05]]            
                          [UB]              [[-2.01918386e-05 -7.20401294e-06  1.15690713e+00]             
                                             [ 0.00000000e+00 -1.15690713e+00 -7.20401295e-06]             
                                             [ 1.15690713e+00 -1.25733816e-10  2.01918386e-05]]            
                          ================= ===============================================================
    ===================== =================================================================================
    




.. parsed-literal::

    <pyRestTable.rest_table.Table at 0x7fe3a373f4c0>



.. code:: ipython3

    class Sixc(SimulatedE6C):
        pass
    
    sixc = Sixc("", name="sixc")
    sixc.energy.put(A_KEV / 1.54)
    a0 = 5.4310196
    sixc.calc.new_sample("silicon", lattice=(a0, a0, a0, 90, 90, 90))
    sixc.calc.sample.compute_UB(
        sixc.calc.sample.add_reflection(4, 0, 0, (0, -145.451, 0, 0, 0, 69.0966)),
        sixc.calc.sample.add_reflection(0, 4, 0, (0, -145.451, 90, 0, 0, 69.0966))
    )
    sixc.pa()


.. parsed-literal::

    ===================== ========================================================================================================
    term                  value                                                                                                   
    ===================== ========================================================================================================
    diffractometer        sixc                                                                                                    
    geometry              E6C                                                                                                     
    class                 Sixc                                                                                                    
    energy (keV)          8.05092                                                                                                 
    wavelength (angstrom) 1.54000                                                                                                 
    calc engine           hkl                                                                                                     
    mode                  bissector_vertical                                                                                      
    positions             ===== =======                                                                                           
                          name  value                                                                                             
                          ===== =======                                                                                           
                          mu    0.00000                                                                                           
                          omega 0.00000                                                                                           
                          chi   0.00000                                                                                           
                          phi   0.00000                                                                                           
                          gamma 0.00000                                                                                           
                          delta 0.00000                                                                                           
                          ===== =======                                                                                           
    constraints           ===== ========= ========== ===== ====                                                                   
                          axis  low_limit high_limit value fit                                                                    
                          ===== ========= ========== ===== ====                                                                   
                          mu    -180.0    180.0      0.0   True                                                                   
                          omega -180.0    180.0      0.0   True                                                                   
                          chi   -180.0    180.0      0.0   True                                                                   
                          phi   -180.0    180.0      0.0   True                                                                   
                          gamma -180.0    180.0      0.0   True                                                                   
                          delta -180.0    180.0      0.0   True                                                                   
                          ===== ========= ========== ===== ====                                                                   
    sample: silicon       ================= ======================================================================================
                          term              value                                                                                 
                          ================= ======================================================================================
                          unit cell edges   a=5.4310196, b=5.4310196, c=5.4310196                                                 
                          unit cell angles  alpha=90.0, beta=90.0, gamma=90.0                                                     
                          ref 1 (hkl)       h=4.0, k=0.0, l=0.0                                                                   
                          ref 1 positioners mu=0.00000, omega=-145.45100, chi=0.00000, phi=0.00000, gamma=0.00000, delta=69.09660 
                          ref 2 (hkl)       h=0.0, k=4.0, l=0.0                                                                   
                          ref 2 positioners mu=0.00000, omega=-145.45100, chi=90.00000, phi=0.00000, gamma=0.00000, delta=69.09660
                          [U]               [[-1.22173048e-05 -1.22173048e-05 -1.00000000e+00]                                    
                                             [ 0.00000000e+00 -1.00000000e+00  1.22173048e-05]                                    
                                             [-1.00000000e+00  1.49262536e-10  1.22173048e-05]]                                   
                          [UB]              [[-1.41342870e-05 -1.41342870e-05 -1.15690713e+00]                                    
                                             [ 0.00000000e+00 -1.15690713e+00  1.41342870e-05]                                    
                                             [-1.15690713e+00  1.72682963e-10  1.41342870e-05]]                                   
                          ================= ======================================================================================
    ===================== ========================================================================================================
    




.. parsed-literal::

    <pyRestTable.rest_table.Table at 0x7fe3a3774d00>



Collect data with all the diffractometers
-----------------------------------------

Show data collection with and without the orientation information.

**Tip**: To save orientation information, add the diffractometer as an
additional detector. That’s all! Works with any scan that supports
multiple detectors.

.. code:: ipython3

    def scan_all():
        ### count runs ###
        # this run will not save orientation information
        yield from bp.count([noisy_det])
        # this run _will_ save orientation information for fourc
        yield from bp.count([noisy_det, fourc])
        # this run _will_ save orientation information for several diffractometers
        yield from bp.count([noisy_det, fourc, orange, kappa, sixc])
    
        ### scan runs ###
        yield from bp.scan([noisy_det], fourc.h, 0.9, 1.1, 2)
        yield from bp.scan([noisy_det, fourc], fourc.h, 0.9, 1.1, 2)
        yield from bp.scan([noisy_det], kappa.h, 0.9, 1.1, 2)
        yield from bp.scan([noisy_det, kappa], kappa.h, 0.9, 1.1, 2)
        yield from bp.scan([noisy_det], sixc.h, 0.9, 1.1, 2)
        yield from bp.scan([noisy_det, sixc], sixc.h, 0.9, 1.1, 2)
    
        ### mesh runs at the (100) ###
        # first, move to the (100)
        yield from bps.mv(fourc.h, 1, fourc.k, 0, fourc.l, 0)
        yield from bp.rel_grid_scan([noisy_det], fourc.h, -0.1, 0.1, 3, fourc.k, -0.1, 0.1, 3)
        yield from bp.rel_grid_scan([noisy_det, fourc], fourc.h, -0.1, 0.1, 3, fourc.k, -0.1, 0.1, 3)

Run the scans, gather all the uids into a variable to be ignored. That
way, they do not print.

.. code:: ipython3

    _uids = RE(scan_all())


.. parsed-literal::

    
    
    Transient Scan ID: 1     Time: 2021-05-17 11:32:45
    Persistent Unique Scan ID: '86f981f5-f0ea-4133-968f-0dca15ce97c7'
    New stream: 'primary'
    +-----------+------------+------------+
    |   seq_num |       time |  noisy_det |
    +-----------+------------+------------+
    |         1 | 11:32:45.5 |      1.081 |
    +-----------+------------+------------+
    generator count ['86f981f5'] (scan num: 1)
    
    
    
    
    
    Transient Scan ID: 2     Time: 2021-05-17 11:32:45
    Persistent Unique Scan ID: '0253342c-f51f-491b-b340-e27f4a309a47'
    New stream: 'primary'
    +-----------+------------+------------+------------+------------+------------+
    |   seq_num |       time |  noisy_det |    fourc_h |    fourc_k |    fourc_l |
    +-----------+------------+------------+------------+------------+------------+
    |         1 | 11:32:45.6 |      1.039 |      0.000 |      0.000 |      0.000 |
    +-----------+------------+------------+------------+------------+------------+
    generator count ['0253342c'] (scan num: 2)
    
    
    
    
    
    Transient Scan ID: 3     Time: 2021-05-17 11:32:45
    Persistent Unique Scan ID: 'ad274f0c-d5f7-4ac1-88ed-de6aa4588a3a'
    New stream: 'primary'
    +-----------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+
    |   seq_num |       time |     sixc_h |     sixc_k |     sixc_l |    fourc_h |    fourc_k |    fourc_l |   orange_h |   orange_k |   orange_l |    kappa_h |    kappa_k |    kappa_l |  noisy_det |
    +-----------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+
    |         1 | 11:32:45.8 |     -0.000 |      0.000 |      0.000 |      0.000 |      0.000 |      0.000 |      0.000 |      0.000 |      0.000 |      0.000 |     -0.000 |      0.000 |      1.045 |
    +-----------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+
    generator count ['ad274f0c'] (scan num: 3)
    
    
    
    
    
    Transient Scan ID: 4     Time: 2021-05-17 11:32:45
    Persistent Unique Scan ID: '282c1a1d-072a-4cc0-8921-8c02767e427c'
    New stream: 'primary'
    +-----------+------------+------------+------------+
    |   seq_num |       time |    fourc_h |  noisy_det |
    +-----------+------------+------------+------------+
    |         1 | 11:32:45.9 |      0.900 |      0.900 |
    |         2 | 11:32:45.9 |      1.100 |      0.901 |
    +-----------+------------+------------+------------+
    generator scan ['282c1a1d'] (scan num: 4)
    
    
    
    
    
    Transient Scan ID: 5     Time: 2021-05-17 11:32:46
    Persistent Unique Scan ID: '51327591-7e2e-45ae-8f3e-15b2d6fa8afd'
    New stream: 'primary'
    +-----------+------------+------------+------------+------------+------------+
    |   seq_num |       time |    fourc_h |  noisy_det |    fourc_k |    fourc_l |
    +-----------+------------+------------+------------+------------+------------+
    |         1 | 11:32:46.1 |      0.900 |      1.057 |     -0.000 |      0.000 |
    |         2 | 11:32:46.1 |      1.100 |      1.092 |      0.000 |     -0.000 |
    +-----------+------------+------------+------------+------------+------------+
    generator scan ['51327591'] (scan num: 5)
    
    
    
    
    
    Transient Scan ID: 6     Time: 2021-05-17 11:32:46
    Persistent Unique Scan ID: '5943a85c-ab11-4cad-8174-18d86c240b0e'
    New stream: 'primary'
    +-----------+------------+------------+------------+
    |   seq_num |       time |    kappa_h |  noisy_det |
    +-----------+------------+------------+------------+
    |         1 | 11:32:46.3 |      0.900 |      1.091 |
    |         2 | 11:32:46.4 |      1.100 |      0.985 |
    +-----------+------------+------------+------------+
    generator scan ['5943a85c'] (scan num: 6)
    
    
    
    
    
    Transient Scan ID: 7     Time: 2021-05-17 11:32:46
    Persistent Unique Scan ID: 'f1205a9e-bd22-4b83-8ede-08ad61f07587'
    New stream: 'primary'
    +-----------+------------+------------+------------+------------+------------+
    |   seq_num |       time |    kappa_h |    kappa_k |    kappa_l |  noisy_det |
    +-----------+------------+------------+------------+------------+------------+
    |         1 | 11:32:46.7 |      0.900 |      0.000 |     -0.000 |      1.047 |
    |         2 | 11:32:46.8 |      1.100 |      0.000 |      0.000 |      0.941 |
    +-----------+------------+------------+------------+------------+------------+
    generator scan ['f1205a9e'] (scan num: 7)
    
    
    
    
    
    Transient Scan ID: 8     Time: 2021-05-17 11:32:46
    Persistent Unique Scan ID: '65f61f74-dac4-43fa-9a94-b82918968efd'
    New stream: 'primary'
    +-----------+------------+------------+------------+
    |   seq_num |       time |     sixc_h |  noisy_det |
    +-----------+------------+------------+------------+
    |         1 | 11:32:46.9 |      0.900 |      0.911 |
    |         2 | 11:32:46.9 |      1.100 |      1.043 |
    +-----------+------------+------------+------------+
    generator scan ['65f61f74'] (scan num: 8)
    
    
    
    
    
    Transient Scan ID: 9     Time: 2021-05-17 11:32:47
    Persistent Unique Scan ID: '9f3f659d-6b42-4e22-95b0-eefb40946b2a'
    New stream: 'primary'
    +-----------+------------+------------+------------+------------+------------+
    |   seq_num |       time |     sixc_h |     sixc_k |     sixc_l |  noisy_det |
    +-----------+------------+------------+------------+------------+------------+
    |         1 | 11:32:47.1 |      0.900 |     -0.000 |     -0.000 |      1.001 |
    |         2 | 11:32:47.1 |      1.100 |      0.000 |      0.000 |      1.088 |
    +-----------+------------+------------+------------+------------+------------+
    generator scan ['9f3f659d'] (scan num: 9)
    
    
    
    
    
    Transient Scan ID: 10     Time: 2021-05-17 11:32:47
    Persistent Unique Scan ID: '7fb76d3c-c45a-48b0-a24c-7a195d5812b5'
    New stream: 'primary'
    +-----------+------------+------------+------------+------------+------------+
    |   seq_num |       time |    fourc_h |    fourc_k |  noisy_det |    fourc_l |
    +-----------+------------+------------+------------+------------+------------+
    |         1 | 11:32:47.3 |      0.900 |     -0.100 |      1.047 |      0.000 |
    |         2 | 11:32:47.3 |      0.900 |     -0.000 |      0.945 |      0.000 |
    |         3 | 11:32:47.3 |      0.900 |      0.100 |      0.945 |      0.000 |
    |         4 | 11:32:47.3 |      1.000 |     -0.100 |      0.979 |      0.000 |
    |         5 | 11:32:47.4 |      1.000 |     -0.000 |      0.953 |      0.000 |
    |         6 | 11:32:47.4 |      1.000 |      0.100 |      0.988 |      0.000 |
    |         7 | 11:32:47.4 |      1.100 |     -0.100 |      0.912 |      0.000 |
    |         8 | 11:32:47.4 |      1.100 |     -0.000 |      0.986 |      0.000 |
    |         9 | 11:32:47.4 |      1.100 |      0.100 |      0.903 |      0.000 |
    +-----------+------------+------------+------------+------------+------------+
    generator rel_grid_scan ['7fb76d3c'] (scan num: 10)
    
    
    
    
    
    Transient Scan ID: 11     Time: 2021-05-17 11:32:47
    Persistent Unique Scan ID: '61533526-709a-44e8-9b23-8681b37aaadd'
    New stream: 'primary'
    +-----------+------------+------------+------------+------------+------------+
    |   seq_num |       time |    fourc_h |    fourc_k |  noisy_det |    fourc_l |
    +-----------+------------+------------+------------+------------+------------+
    |         1 | 11:32:47.6 |      0.900 |     -0.100 |      0.984 |      0.000 |
    |         2 | 11:32:47.6 |      0.900 |     -0.000 |      1.062 |      0.000 |
    |         3 | 11:32:47.6 |      0.900 |      0.100 |      0.950 |      0.000 |
    |         4 | 11:32:47.6 |      1.000 |     -0.100 |      0.924 |      0.000 |
    |         5 | 11:32:47.6 |      1.000 |     -0.000 |      0.901 |      0.000 |
    |         6 | 11:32:47.7 |      1.000 |      0.100 |      1.098 |      0.000 |
    |         7 | 11:32:47.7 |      1.100 |     -0.100 |      1.072 |      0.000 |
    |         8 | 11:32:47.7 |      1.100 |     -0.000 |      1.078 |      0.000 |
    |         9 | 11:32:47.7 |      1.100 |      0.100 |      0.943 |      0.000 |
    +-----------+------------+------------+------------+------------+------------+
    generator rel_grid_scan ['61533526'] (scan num: 11)
    
    
    


--------------

Show the orientation information that was collected
===================================================

Show the full contents of the descriptor document (primary stream) for
the ``fourc`` “detector” from the run with ``scan_id=5``. This is where
the orientation information is saved. You may need to expand the *Data
variables* row to see all the orientation information.

.. code:: ipython3

    cat[5].primary.config["fourc"].read()




.. raw:: html

    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */
    
    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }
    
    html[theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }
    
    .xr-wrap {
      display: block;
      min-width: 300px;
      max-width: 700px;
    }
    
    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }
    
    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }
    
    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }
    
    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }
    
    .xr-obj-type {
      color: var(--xr-font-color2);
    }
    
    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }
    
    .xr-section-item {
      display: contents;
    }
    
    .xr-section-item input {
      display: none;
    }
    
    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }
    
    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }
    
    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }
    
    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }
    
    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }
    
    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }
    
    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '►';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }
    
    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }
    
    .xr-section-summary-in:checked + label:before {
      content: '▼';
    }
    
    .xr-section-summary-in:checked + label > span {
      display: none;
    }
    
    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }
    
    .xr-section-inline-details {
      grid-column: 2 / -1;
    }
    
    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }
    
    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }
    
    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }
    
    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }
    
    .xr-preview {
      color: var(--xr-font-color3);
    }
    
    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }
    
    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }
    
    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }
    
    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }
    
    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }
    
    .xr-dim-list:before {
      content: '(';
    }
    
    .xr-dim-list:after {
      content: ')';
    }
    
    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }
    
    .xr-has-index {
      font-weight: bold;
    }
    
    .xr-var-list,
    .xr-var-item {
      display: contents;
    }
    
    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }
    
    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }
    
    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }
    
    .xr-var-name {
      grid-column: 1;
    }
    
    .xr-var-dims {
      grid-column: 2;
    }
    
    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }
    
    .xr-var-preview {
      grid-column: 4;
    }
    
    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }
    
    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }
    
    .xr-var-attrs,
    .xr-var-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }
    
    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data {
      display: block;
    }
    
    .xr-var-data > table {
      float: right;
    }
    
    .xr-var-name span,
    .xr-var-data,
    .xr-attrs {
      padding-left: 25px !important;
    }
    
    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data {
      grid-column: 1 / -1;
    }
    
    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }
    
    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }
    
    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }
    
    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }
    
    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    .xr-icon-database,
    .xr-icon-file-text2 {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
    Dimensions:                    (dim_0: 6, dim_1: 6, dim_10: 4, dim_11: 21, dim_2: 3, dim_3: 3, dim_4: 3, dim_5: 3, dim_6: 2, dim_7: 3, dim_8: 4, dim_9: 4, time: 2)
    Coordinates:
      * time                       (time) float64 1.621e+09 1.621e+09
    Dimensions without coordinates: dim_0, dim_1, dim_10, dim_11, dim_2, dim_3, dim_4, dim_5, dim_6, dim_7, dim_8, dim_9
    Data variables: (12/21)
        fourc_energy               (time) float64 8.051 8.051
        fourc_energy_units         (time) &lt;U3 &#x27;keV&#x27; &#x27;keV&#x27;
        fourc_energy_offset        (time) int64 0 0
        fourc_geometry_name        (time) &lt;U4 &#x27;E4CV&#x27; &#x27;E4CV&#x27;
        fourc_class_name           (time) &lt;U5 &#x27;Fourc&#x27; &#x27;Fourc&#x27;
        fourc_sample_name          (time) &lt;U7 &#x27;silicon&#x27; &#x27;silicon&#x27;
        ...                         ...
        fourc__hklpy_version       (time) &lt;U24 &#x27;0.3.16+36.g1cc5d9e.dirty&#x27; &#x27;0.3.16...
        fourc__pseudos             (time, dim_7) &lt;U1 &#x27;h&#x27; &#x27;k&#x27; &#x27;l&#x27; &#x27;h&#x27; &#x27;k&#x27; &#x27;l&#x27;
        fourc__reals               (time, dim_8) &lt;U5 &#x27;omega&#x27; &#x27;chi&#x27; ... &#x27;phi&#x27; &#x27;tth&#x27;
        fourc__constraints         (time, dim_9, dim_10) float64 -180.0 ... 1.0
        fourc__mode                (time) &lt;U9 &#x27;bissector&#x27; &#x27;bissector&#x27;
        fourc_orientation_attrs    (time, dim_11) &lt;U19 &#x27;orientation_attrs&#x27; ... &#x27;_...</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-9e09cec7-25ef-4bd4-8f6b-12111d5ff812' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-9e09cec7-25ef-4bd4-8f6b-12111d5ff812' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span>dim_0</span>: 6</li><li><span>dim_1</span>: 6</li><li><span>dim_10</span>: 4</li><li><span>dim_11</span>: 21</li><li><span>dim_2</span>: 3</li><li><span>dim_3</span>: 3</li><li><span>dim_4</span>: 3</li><li><span>dim_5</span>: 3</li><li><span>dim_6</span>: 2</li><li><span>dim_7</span>: 3</li><li><span>dim_8</span>: 4</li><li><span>dim_9</span>: 4</li><li><span class='xr-has-index'>time</span>: 2</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-7f884d41-408b-4b9a-ba69-c05bdb813635' class='xr-section-summary-in' type='checkbox'  checked><label for='section-7f884d41-408b-4b9a-ba69-c05bdb813635' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.621e+09 1.621e+09</div><input id='attrs-9abd6349-4a72-4eea-b65e-e7add9899cfe' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9abd6349-4a72-4eea-b65e-e7add9899cfe' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9d4edc7c-ea79-4fb5-b31c-116c1158457f' class='xr-var-data-in' type='checkbox'><label for='data-9d4edc7c-ea79-4fb5-b31c-116c1158457f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1.621269e+09, 1.621269e+09])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-1cc3b13c-4e9b-4ab6-8dfa-8735d78d3bb4' class='xr-section-summary-in' type='checkbox'  ><label for='section-1cc3b13c-4e9b-4ab6-8dfa-8735d78d3bb4' class='xr-section-summary' >Data variables: <span>(21)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>fourc_energy</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>8.051 8.051</div><input id='attrs-59275079-911b-449e-bdcc-45ba8c0f4659' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-59275079-911b-449e-bdcc-45ba8c0f4659' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cd5360f6-f9dd-4169-94c7-ae27b7b4f28b' class='xr-var-data-in' type='checkbox'><label for='data-cd5360f6-f9dd-4169-94c7-ae27b7b4f28b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([8.05092208, 8.05092208])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_energy_units</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>&lt;U3</div><div class='xr-var-preview xr-preview'>&#x27;keV&#x27; &#x27;keV&#x27;</div><input id='attrs-fc3727c4-9886-49be-850b-2e551cbf6088' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fc3727c4-9886-49be-850b-2e551cbf6088' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fa4c11ef-f96b-4e78-89fb-ccc0332fca6b' class='xr-var-data-in' type='checkbox'><label for='data-fa4c11ef-f96b-4e78-89fb-ccc0332fca6b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;keV&#x27;, &#x27;keV&#x27;], dtype=&#x27;&lt;U3&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_energy_offset</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 0</div><input id='attrs-be4f3f36-a57d-4db5-8417-6b9cb214f6d1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-be4f3f36-a57d-4db5-8417-6b9cb214f6d1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cb5d33d6-d9a1-42fe-8bd6-0fe5c071507e' class='xr-var-data-in' type='checkbox'><label for='data-cb5d33d6-d9a1-42fe-8bd6-0fe5c071507e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0, 0])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_geometry_name</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>&lt;U4</div><div class='xr-var-preview xr-preview'>&#x27;E4CV&#x27; &#x27;E4CV&#x27;</div><input id='attrs-91cfeb89-3917-4741-afed-5f95445bb451' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-91cfeb89-3917-4741-afed-5f95445bb451' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-909ffa53-c399-4e5e-9150-dab03c83dc28' class='xr-var-data-in' type='checkbox'><label for='data-909ffa53-c399-4e5e-9150-dab03c83dc28' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;E4CV&#x27;, &#x27;E4CV&#x27;], dtype=&#x27;&lt;U4&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_class_name</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>&lt;U5</div><div class='xr-var-preview xr-preview'>&#x27;Fourc&#x27; &#x27;Fourc&#x27;</div><input id='attrs-54abb98e-9aac-4216-90fc-5e14402a0041' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-54abb98e-9aac-4216-90fc-5e14402a0041' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cd42eb96-4403-4f8d-bfd9-7f65c24259ee' class='xr-var-data-in' type='checkbox'><label for='data-cd42eb96-4403-4f8d-bfd9-7f65c24259ee' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Fourc&#x27;, &#x27;Fourc&#x27;], dtype=&#x27;&lt;U5&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_sample_name</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;silicon&#x27; &#x27;silicon&#x27;</div><input id='attrs-d8e473d8-03c0-47c8-8960-415df7cc9529' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d8e473d8-03c0-47c8-8960-415df7cc9529' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fd2d862c-846d-475b-8545-7edea0372faf' class='xr-var-data-in' type='checkbox'><label for='data-fd2d862c-846d-475b-8545-7edea0372faf' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;silicon&#x27;, &#x27;silicon&#x27;], dtype=&#x27;&lt;U7&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_lattice</span></div><div class='xr-var-dims'>(time, dim_0)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>5.431 5.431 5.431 ... 90.0 90.0</div><input id='attrs-b49f7b07-d42d-4c5d-bbcf-e66581597dcd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b49f7b07-d42d-4c5d-bbcf-e66581597dcd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-70d7ac54-ec84-422c-a335-a66a1a681e27' class='xr-var-data-in' type='checkbox'><label for='data-70d7ac54-ec84-422c-a335-a66a1a681e27' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ 5.4310196,  5.4310196,  5.4310196, 90.       , 90.       ,
            90.       ],
           [ 5.4310196,  5.4310196,  5.4310196, 90.       , 90.       ,
            90.       ]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_lattice_reciprocal</span></div><div class='xr-var-dims'>(time, dim_1)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.157 1.157 1.157 ... 90.0 90.0</div><input id='attrs-ddb89b05-f464-4b39-ad21-5d8b8a98ebeb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ddb89b05-f464-4b39-ad21-5d8b8a98ebeb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-df1959bf-a132-4971-9b6b-2add7fa5f450' class='xr-var-data-in' type='checkbox'><label for='data-df1959bf-a132-4971-9b6b-2add7fa5f450' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ 1.15690713,  1.15690713,  1.15690713, 90.        , 90.        ,
            90.        ],
           [ 1.15690713,  1.15690713,  1.15690713, 90.        , 90.        ,
            90.        ]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_U</span></div><div class='xr-var-dims'>(time, dim_2, dim_3)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.222e-05 -1.0 ... 1.222e-05 0.0</div><input id='attrs-8a705c6c-81af-4190-8b6f-0f08c48200e3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8a705c6c-81af-4190-8b6f-0f08c48200e3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-318b8c6b-53d4-46e2-a13f-8eef3074590d' class='xr-var-data-in' type='checkbox'><label for='data-318b8c6b-53d4-46e2-a13f-8eef3074590d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[-1.22173048e-05, -1.00000000e+00,  0.00000000e+00],
            [ 0.00000000e+00,  0.00000000e+00,  1.00000000e+00],
            [-1.00000000e+00,  1.22173048e-05,  0.00000000e+00]],
    
           [[-1.22173048e-05, -1.00000000e+00,  0.00000000e+00],
            [ 0.00000000e+00,  0.00000000e+00,  1.00000000e+00],
            [-1.00000000e+00,  1.22173048e-05,  0.00000000e+00]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_UB</span></div><div class='xr-var-dims'>(time, dim_4, dim_5)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.413e-05 -1.157 ... 7.084e-17</div><input id='attrs-4583f42a-68ac-40eb-8328-bf2c32999d55' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4583f42a-68ac-40eb-8328-bf2c32999d55' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8d715b59-7be0-48b7-b9c0-acc234650b6a' class='xr-var-data-in' type='checkbox'><label for='data-8d715b59-7be0-48b7-b9c0-acc234650b6a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[-1.41342870e-05, -1.15690713e+00,  7.08409963e-17],
            [ 0.00000000e+00,  0.00000000e+00,  1.15690713e+00],
            [-1.15690713e+00,  1.41342870e-05,  7.08392653e-17]],
    
           [[-1.41342870e-05, -1.15690713e+00,  7.08409963e-17],
            [ 0.00000000e+00,  0.00000000e+00,  1.15690713e+00],
            [-1.15690713e+00,  1.41342870e-05,  7.08392653e-17]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_reflections_details</span></div><div class='xr-var-dims'>(time, dim_6)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>{&#x27;reflection&#x27;: {&#x27;h&#x27;: 4.0, &#x27;k&#x27;: 0...</div><input id='attrs-c8e2aa04-2039-4ff3-8e14-dce9a78e32e0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c8e2aa04-2039-4ff3-8e14-dce9a78e32e0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a60eb2bf-cf48-46db-9f2b-960143273ac2' class='xr-var-data-in' type='checkbox'><label for='data-a60eb2bf-cf48-46db-9f2b-960143273ac2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[{&#x27;reflection&#x27;: {&#x27;h&#x27;: 4.0, &#x27;k&#x27;: 0.0, &#x27;l&#x27;: 0.0}, &#x27;flag&#x27;: 1, &#x27;wavelength&#x27;: 1.54, &#x27;position&#x27;: {&#x27;omega&#x27;: -145.451, &#x27;chi&#x27;: 0.0, &#x27;phi&#x27;: 0.0, &#x27;tth&#x27;: 69.0966}, &#x27;orientation_reflection&#x27;: True},
            {&#x27;reflection&#x27;: {&#x27;h&#x27;: 0.0, &#x27;k&#x27;: 4.0, &#x27;l&#x27;: 0.0}, &#x27;flag&#x27;: 1, &#x27;wavelength&#x27;: 1.54, &#x27;position&#x27;: {&#x27;omega&#x27;: -145.451, &#x27;chi&#x27;: 0.0, &#x27;phi&#x27;: 90.0, &#x27;tth&#x27;: 69.0966}, &#x27;orientation_reflection&#x27;: True}],
           [{&#x27;reflection&#x27;: {&#x27;h&#x27;: 4.0, &#x27;k&#x27;: 0.0, &#x27;l&#x27;: 0.0}, &#x27;flag&#x27;: 1, &#x27;wavelength&#x27;: 1.54, &#x27;position&#x27;: {&#x27;omega&#x27;: -145.451, &#x27;chi&#x27;: 0.0, &#x27;phi&#x27;: 0.0, &#x27;tth&#x27;: 69.0966}, &#x27;orientation_reflection&#x27;: True},
            {&#x27;reflection&#x27;: {&#x27;h&#x27;: 0.0, &#x27;k&#x27;: 4.0, &#x27;l&#x27;: 0.0}, &#x27;flag&#x27;: 1, &#x27;wavelength&#x27;: 1.54, &#x27;position&#x27;: {&#x27;omega&#x27;: -145.451, &#x27;chi&#x27;: 0.0, &#x27;phi&#x27;: 90.0, &#x27;tth&#x27;: 69.0966}, &#x27;orientation_reflection&#x27;: True}]],
          dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_ux</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-90.0 -90.0</div><input id='attrs-88e1c2de-11d2-44a5-87b7-962a344c0ea3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-88e1c2de-11d2-44a5-87b7-962a344c0ea3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bac39320-9c00-4e31-9c1a-3b16eabfde27' class='xr-var-data-in' type='checkbox'><label for='data-bac39320-9c00-4e31-9c1a-3b16eabfde27' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-90., -90.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_uy</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.0</div><input id='attrs-73cca467-5434-4902-a100-4862953c38da' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-73cca467-5434-4902-a100-4862953c38da' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-241de429-dd10-4dc0-ad00-bae67d1b5dae' class='xr-var-data-in' type='checkbox'><label for='data-241de429-dd10-4dc0-ad00-bae67d1b5dae' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0., 0.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_uz</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>90.0 90.0</div><input id='attrs-6571d4e6-b9be-401c-8116-b9131e88007f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6571d4e6-b9be-401c-8116-b9131e88007f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2c7c3340-d849-438c-be35-f83f4b51b27d' class='xr-var-data-in' type='checkbox'><label for='data-2c7c3340-d849-438c-be35-f83f4b51b27d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([90.0007, 90.0007])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_diffractometer_name</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>&lt;U5</div><div class='xr-var-preview xr-preview'>&#x27;fourc&#x27; &#x27;fourc&#x27;</div><input id='attrs-95ffecd7-9325-4549-adbf-31615bcbfa77' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-95ffecd7-9325-4549-adbf-31615bcbfa77' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8a2060c4-e8c4-4d9d-9cdb-569cc67b4f43' class='xr-var-data-in' type='checkbox'><label for='data-8a2060c4-e8c4-4d9d-9cdb-569cc67b4f43' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;fourc&#x27;, &#x27;fourc&#x27;], dtype=&#x27;&lt;U5&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc__hklpy_version</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>&lt;U24</div><div class='xr-var-preview xr-preview'>&#x27;0.3.16+36.g1cc5d9e.dirty&#x27; &#x27;0.3....</div><input id='attrs-7bc75cad-3fa9-4429-9032-c8f61a3011dd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7bc75cad-3fa9-4429-9032-c8f61a3011dd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-62edfc16-6104-4861-a7bb-1dcdd98c0cc9' class='xr-var-data-in' type='checkbox'><label for='data-62edfc16-6104-4861-a7bb-1dcdd98c0cc9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;0.3.16+36.g1cc5d9e.dirty&#x27;, &#x27;0.3.16+36.g1cc5d9e.dirty&#x27;],
          dtype=&#x27;&lt;U24&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc__pseudos</span></div><div class='xr-var-dims'>(time, dim_7)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;h&#x27; &#x27;k&#x27; &#x27;l&#x27; &#x27;h&#x27; &#x27;k&#x27; &#x27;l&#x27;</div><input id='attrs-8138369e-8409-419c-9055-c4d078099172' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8138369e-8409-419c-9055-c4d078099172' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ff902533-8296-4946-be00-5467e770bd2b' class='xr-var-data-in' type='checkbox'><label for='data-ff902533-8296-4946-be00-5467e770bd2b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[&#x27;h&#x27;, &#x27;k&#x27;, &#x27;l&#x27;],
           [&#x27;h&#x27;, &#x27;k&#x27;, &#x27;l&#x27;]], dtype=&#x27;&lt;U1&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc__reals</span></div><div class='xr-var-dims'>(time, dim_8)</div><div class='xr-var-dtype'>&lt;U5</div><div class='xr-var-preview xr-preview'>&#x27;omega&#x27; &#x27;chi&#x27; &#x27;phi&#x27; ... &#x27;phi&#x27; &#x27;tth&#x27;</div><input id='attrs-9ac77dee-13e6-459a-b4f1-bc5fbb868f07' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9ac77dee-13e6-459a-b4f1-bc5fbb868f07' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2a1e8d4a-7dc5-4ced-9fcf-5ba6d5b7b481' class='xr-var-data-in' type='checkbox'><label for='data-2a1e8d4a-7dc5-4ced-9fcf-5ba6d5b7b481' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[&#x27;omega&#x27;, &#x27;chi&#x27;, &#x27;phi&#x27;, &#x27;tth&#x27;],
           [&#x27;omega&#x27;, &#x27;chi&#x27;, &#x27;phi&#x27;, &#x27;tth&#x27;]], dtype=&#x27;&lt;U5&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc__constraints</span></div><div class='xr-var-dims'>(time, dim_9, dim_10)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-180.0 180.0 -7.331 ... -14.66 1.0</div><input id='attrs-ddf406d2-d44b-4f67-8245-dbe767d50988' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ddf406d2-d44b-4f67-8245-dbe767d50988' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1ca8e4fe-c538-4d36-b795-b5beb783be8e' class='xr-var-data-in' type='checkbox'><label for='data-1ca8e4fe-c538-4d36-b795-b5beb783be8e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[-1.80000000e+02,  1.80000000e+02, -7.33094761e+00,
              1.00000000e+00],
            [-1.80000000e+02,  1.80000000e+02, -3.73820157e-86,
              1.00000000e+00],
            [-1.80000000e+02,  1.80000000e+02,  6.99999999e-04,
              1.00000000e+00],
            [-1.80000000e+02,  1.80000000e+02, -1.46618952e+01,
              1.00000000e+00]],
    
           [[-1.80000000e+02,  1.80000000e+02, -7.33094761e+00,
              1.00000000e+00],
            [-1.80000000e+02,  1.80000000e+02, -3.73820157e-86,
              1.00000000e+00],
            [-1.80000000e+02,  1.80000000e+02,  6.99999999e-04,
              1.00000000e+00],
            [-1.80000000e+02,  1.80000000e+02, -1.46618952e+01,
              1.00000000e+00]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc__mode</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>&lt;U9</div><div class='xr-var-preview xr-preview'>&#x27;bissector&#x27; &#x27;bissector&#x27;</div><input id='attrs-75d4755e-491a-43e4-841a-635b05affdda' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-75d4755e-491a-43e4-841a-635b05affdda' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-64f8180f-62e4-4ad5-b788-fe95f3d3de10' class='xr-var-data-in' type='checkbox'><label for='data-64f8180f-62e4-4ad5-b788-fe95f3d3de10' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;bissector&#x27;, &#x27;bissector&#x27;], dtype=&#x27;&lt;U9&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fourc_orientation_attrs</span></div><div class='xr-var-dims'>(time, dim_11)</div><div class='xr-var-dtype'>&lt;U19</div><div class='xr-var-preview xr-preview'>&#x27;orientation_attrs&#x27; ... &#x27;_hklpy_...</div><input id='attrs-0750a389-e26a-4581-aed6-d1c9f825b680' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0750a389-e26a-4581-aed6-d1c9f825b680' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-942d849c-e1b0-40e0-88ad-bd4ce1b93365' class='xr-var-data-in' type='checkbox'><label for='data-942d849c-e1b0-40e0-88ad-bd4ce1b93365' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[&#x27;orientation_attrs&#x27;, &#x27;geometry_name&#x27;, &#x27;class_name&#x27;, &#x27;UB&#x27;, &#x27;U&#x27;,
            &#x27;ux&#x27;, &#x27;uy&#x27;, &#x27;uz&#x27;, &#x27;energy&#x27;, &#x27;energy_units&#x27;, &#x27;energy_offset&#x27;,
            &#x27;sample_name&#x27;, &#x27;lattice&#x27;, &#x27;lattice_reciprocal&#x27;,
            &#x27;reflections_details&#x27;, &#x27;_pseudos&#x27;, &#x27;_reals&#x27;, &#x27;_constraints&#x27;,
            &#x27;_mode&#x27;, &#x27;diffractometer_name&#x27;, &#x27;_hklpy_version&#x27;],
           [&#x27;orientation_attrs&#x27;, &#x27;geometry_name&#x27;, &#x27;class_name&#x27;, &#x27;UB&#x27;, &#x27;U&#x27;,
            &#x27;ux&#x27;, &#x27;uy&#x27;, &#x27;uz&#x27;, &#x27;energy&#x27;, &#x27;energy_units&#x27;, &#x27;energy_offset&#x27;,
            &#x27;sample_name&#x27;, &#x27;lattice&#x27;, &#x27;lattice_reciprocal&#x27;,
            &#x27;reflections_details&#x27;, &#x27;_pseudos&#x27;, &#x27;_reals&#x27;, &#x27;_constraints&#x27;,
            &#x27;_mode&#x27;, &#x27;diffractometer_name&#x27;, &#x27;_hklpy_version&#x27;]], dtype=&#x27;&lt;U19&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-449ec711-10c3-4ccd-a2b0-9e9e5eaae5e1' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-449ec711-10c3-4ccd-a2b0-9e9e5eaae5e1' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>



Show orientation that was saved
-------------------------------

In ``scan_id=3``, orientation information from 4 different
diffractometers was saved with the run. Show what is available from each
of those diffractometers. The columns in the next table are the
diffractometers, the rows are the orientation information saved for
each.

.. code:: ipython3

    roi = run_orientation_info(cat[3])
    pd.DataFrame(roi)




.. raw:: html

    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }
    
        .dataframe tbody tr th {
            vertical-align: top;
        }
    
        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>fourc</th>
          <th>kappa</th>
          <th>orange</th>
          <th>sixc</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>energy</th>
          <td>8.05092</td>
          <td>8.05092</td>
          <td>8</td>
          <td>8.05092</td>
        </tr>
        <tr>
          <th>energy_units</th>
          <td>keV</td>
          <td>keV</td>
          <td>keV</td>
          <td>keV</td>
        </tr>
        <tr>
          <th>energy_offset</th>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
        </tr>
        <tr>
          <th>geometry_name</th>
          <td>E4CV</td>
          <td>K4CV</td>
          <td>E4CV</td>
          <td>E6C</td>
        </tr>
        <tr>
          <th>class_name</th>
          <td>Fourc</td>
          <td>Kappa</td>
          <td>Fourc</td>
          <td>Sixc</td>
        </tr>
        <tr>
          <th>sample_name</th>
          <td>silicon</td>
          <td>silicon</td>
          <td>main</td>
          <td>silicon</td>
        </tr>
        <tr>
          <th>lattice</th>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>[1.54, 1.54, 1.54, 90.0, 90.0, 90.0]</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
        </tr>
        <tr>
          <th>lattice_reciprocal</th>
          <td>[1.1569071316147683, 1.1569071316147683, 1.156...</td>
          <td>[1.1569071316147683, 1.1569071316147683, 1.156...</td>
          <td>[4.079990459207523, 4.079990459207523, 4.07999...</td>
          <td>[1.1569071316147683, 1.1569071316147683, 1.156...</td>
        </tr>
        <tr>
          <th>U</th>
          <td>[[-1.2217304763832569e-05, -0.9999999999253688...</td>
          <td>[[-1.7453292519418075e-05, -6.226958714415446e...</td>
          <td>[[1.0, 0.0, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, ...</td>
          <td>[[-1.2217304763832569e-05, -1.2217304762008981...</td>
        </tr>
        <tr>
          <th>UB</th>
          <td>[[-1.4134287010388982e-05, -1.156907131528427,...</td>
          <td>[[-2.0191838585873458e-05, -7.2040129449779575...</td>
          <td>[[4.079990459207523, -2.4982736282101165e-16, ...</td>
          <td>[[-1.4134287010388982e-05, -1.4134287008279258...</td>
        </tr>
        <tr>
          <th>reflections_details</th>
          <td>[{'reflection': {'h': 4.0, 'k': 0.0, 'l': 0.0}...</td>
          <td>[{'reflection': {'h': 4.0, 'k': 0.0, 'l': 0.0}...</td>
          <td>[]</td>
          <td>[{'reflection': {'h': 4.0, 'k': 0.0, 'l': 0.0}...</td>
        </tr>
        <tr>
          <th>ux</th>
          <td>-90</td>
          <td>19.6353</td>
          <td>0</td>
          <td>-45</td>
        </tr>
        <tr>
          <th>uy</th>
          <td>0</td>
          <td>89.9989</td>
          <td>0</td>
          <td>-89.999</td>
        </tr>
        <tr>
          <th>uz</th>
          <td>90.0007</td>
          <td>160.365</td>
          <td>0</td>
          <td>135</td>
        </tr>
        <tr>
          <th>diffractometer_name</th>
          <td>fourc</td>
          <td>kappa</td>
          <td>orange</td>
          <td>sixc</td>
        </tr>
        <tr>
          <th>_hklpy_version</th>
          <td>0.3.16+36.g1cc5d9e.dirty</td>
          <td>0.3.16+36.g1cc5d9e.dirty</td>
          <td>0.3.16+36.g1cc5d9e.dirty</td>
          <td>0.3.16+36.g1cc5d9e.dirty</td>
        </tr>
        <tr>
          <th>_pseudos</th>
          <td>[h, k, l]</td>
          <td>[h, k, l]</td>
          <td>[h, k, l]</td>
          <td>[h, k, l]</td>
        </tr>
        <tr>
          <th>_reals</th>
          <td>[omega, chi, phi, tth]</td>
          <td>[komega, kappa, kphi, tth]</td>
          <td>[omega, chi, phi, tth]</td>
          <td>[mu, omega, chi, phi, gamma, delta]</td>
        </tr>
        <tr>
          <th>_constraints</th>
          <td>[[-180.0, 180.0, 0.0, 1.0], [-180.0, 180.0, 0....</td>
          <td>[[-180.0, 180.0, 0.0, 1.0], [-180.0, 180.0, 0....</td>
          <td>[[-180.0, 180.0, 0.0, 1.0], [-180.0, 180.0, 0....</td>
          <td>[[-180.0, 180.0, 0.0, 1.0], [-180.0, 180.0, 0....</td>
        </tr>
        <tr>
          <th>_mode</th>
          <td>bissector</td>
          <td>bissector</td>
          <td>bissector</td>
          <td>bissector_vertical</td>
        </tr>
        <tr>
          <th>orientation_attrs</th>
          <td>[orientation_attrs, geometry_name, class_name,...</td>
          <td>[orientation_attrs, geometry_name, class_name,...</td>
          <td>[orientation_attrs, geometry_name, class_name,...</td>
          <td>[orientation_attrs, geometry_name, class_name,...</td>
        </tr>
      </tbody>
    </table>
    </div>



Show runs with orientation information
--------------------------------------

Since a given run (``scan_id``) may have more than one set of
orientation information, corresponding to more than one diffractometer,
report for each when found. Here, extra columns are reported for energy
& units, and the crystal lattice parameters. The names are taken from
the above table. (They must be one of the names in the
``orientation_attrs`` list.)

Use this type of listing to determine which **scan_id** and
**diffractometer_name** has the orientation you wish to recover. If the
``scan_id`` is not unique, identify the run with the **uid** (as a
string, such as ``cat["007abcd"]``).

.. code:: ipython3

    list_orientation_runs(cat, "energy", "energy_units", "lattice")




.. raw:: html

    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }
    
        .dataframe tbody tr th {
            vertical-align: top;
        }
    
        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>scan_id</th>
          <th>sample_name</th>
          <th>diffractometer_name</th>
          <th>geometry_name</th>
          <th>energy</th>
          <th>energy_units</th>
          <th>lattice</th>
          <th>uid</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>2</td>
          <td>silicon</td>
          <td>fourc</td>
          <td>E4CV</td>
          <td>8.050922</td>
          <td>keV</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>0253342</td>
        </tr>
        <tr>
          <th>1</th>
          <td>3</td>
          <td>silicon</td>
          <td>fourc</td>
          <td>E4CV</td>
          <td>8.050922</td>
          <td>keV</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>ad274f0</td>
        </tr>
        <tr>
          <th>2</th>
          <td>3</td>
          <td>silicon</td>
          <td>kappa</td>
          <td>K4CV</td>
          <td>8.050922</td>
          <td>keV</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>ad274f0</td>
        </tr>
        <tr>
          <th>3</th>
          <td>3</td>
          <td>main</td>
          <td>orange</td>
          <td>E4CV</td>
          <td>8.000000</td>
          <td>keV</td>
          <td>[1.54, 1.54, 1.54, 90.0, 90.0, 90.0]</td>
          <td>ad274f0</td>
        </tr>
        <tr>
          <th>4</th>
          <td>3</td>
          <td>silicon</td>
          <td>sixc</td>
          <td>E6C</td>
          <td>8.050922</td>
          <td>keV</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>ad274f0</td>
        </tr>
        <tr>
          <th>5</th>
          <td>5</td>
          <td>silicon</td>
          <td>fourc</td>
          <td>E4CV</td>
          <td>8.050922</td>
          <td>keV</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>5132759</td>
        </tr>
        <tr>
          <th>6</th>
          <td>7</td>
          <td>silicon</td>
          <td>kappa</td>
          <td>K4CV</td>
          <td>8.050922</td>
          <td>keV</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>f1205a9</td>
        </tr>
        <tr>
          <th>7</th>
          <td>9</td>
          <td>silicon</td>
          <td>sixc</td>
          <td>E6C</td>
          <td>8.050922</td>
          <td>keV</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>9f3f659</td>
        </tr>
        <tr>
          <th>8</th>
          <td>10</td>
          <td>silicon</td>
          <td>fourc</td>
          <td>E4CV</td>
          <td>8.050922</td>
          <td>keV</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>7fb76d3</td>
        </tr>
        <tr>
          <th>9</th>
          <td>11</td>
          <td>silicon</td>
          <td>fourc</td>
          <td>E4CV</td>
          <td>8.050922</td>
          <td>keV</td>
          <td>[5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, ...</td>
          <td>6153352</td>
        </tr>
      </tbody>
    </table>
    </div>



--------------

Restore orientation information
===============================

This demo will restore the orientation information from a ``fourc`` run
(choosing ``scan_id=2``) to the ``orange`` diffractometer. They have the
same **geometry_name** so the information is compatible.

First, get the orientation information from the chosen run. Show the
information for the ``fourc`` diffractometer.

.. code:: ipython3

    info = run_orientation_info(cat[2])
    
    import pprint
    pprint.pprint(info["fourc"])


.. parsed-literal::

    {'U': [[-1.2217304763832569e-05, -0.9999999999253688, 0.0],
           [0.0, 0.0, 1.0],
           [-0.9999999999253688, 1.2217304763832569e-05, 0.0]],
     'UB': [[-1.4134287010388982e-05, -1.156907131528427, 7.084099625231898e-17],
            [0.0, 0.0, 1.1569071316147683],
            [-1.156907131528427, 1.4134287010459822e-05, 7.083926530138442e-17]],
     '_constraints': [[-180.0, 180.0, 0.0, 1.0],
                      [-180.0, 180.0, 0.0, 1.0],
                      [-180.0, 180.0, 0.0, 1.0],
                      [-180.0, 180.0, 0.0, 1.0]],
     '_hklpy_version': '0.3.16+36.g1cc5d9e.dirty',
     '_mode': 'bissector',
     '_pseudos': ['h', 'k', 'l'],
     '_reals': ['omega', 'chi', 'phi', 'tth'],
     'class_name': 'Fourc',
     'diffractometer_name': 'fourc',
     'energy': 8.050922077922078,
     'energy_offset': 0,
     'energy_units': 'keV',
     'geometry_name': 'E4CV',
     'lattice': [5.4310196, 5.4310196, 5.4310196, 90.0, 90.0, 90.0],
     'lattice_reciprocal': [1.1569071316147683,
                            1.1569071316147683,
                            1.1569071316147683,
                            90.00000000000001,
                            90.00000000000001,
                            90.00000000000001],
     'orientation_attrs': ['orientation_attrs',
                           'geometry_name',
                           'class_name',
                           'UB',
                           'U',
                           'ux',
                           'uy',
                           'uz',
                           'energy',
                           'energy_units',
                           'energy_offset',
                           'sample_name',
                           'lattice',
                           'lattice_reciprocal',
                           'reflections_details',
                           '_pseudos',
                           '_reals',
                           '_constraints',
                           '_mode',
                           'diffractometer_name',
                           '_hklpy_version'],
     'reflections_details': [{'flag': 1,
                              'orientation_reflection': True,
                              'position': {'chi': 0.0,
                                           'omega': -145.451,
                                           'phi': 0.0,
                                           'tth': 69.0966},
                              'reflection': {'h': 4.0, 'k': 0.0, 'l': 0.0},
                              'wavelength': 1.54},
                             {'flag': 1,
                              'orientation_reflection': True,
                              'position': {'chi': 0.0,
                                           'omega': -145.451,
                                           'phi': 90.0,
                                           'tth': 69.0966},
                              'reflection': {'h': 0.0, 'k': 4.0, 'l': 0.0},
                              'wavelength': 1.54}],
     'sample_name': 'silicon',
     'ux': -90.0,
     'uy': 0.0,
     'uz': 90.00070000000002}


Earlier, the sample and orientation were setup on the ``fourc`` with
these steps:

.. code:: python

   fourc.energy.put(A_KEV / 1.54)
   a0 = 5.4310196
   fourc.calc.new_sample("silicon", lattice=(a0, a0, a0, 90, 90, 90))
   fourc.calc.sample.compute_UB(
       fourc.calc.sample.add_reflection(4, 0, 0, (-145.451, 0, 0, 69.0966)),
       fourc.calc.sample.add_reflection(0, 4, 0, (-145.451, 0, 90, 69.0966))
   )

We have all the information here to repeat those steps for the
``orange`` diffractometer (same ``E4CV`` geometry).

+-----------------------------------+-----------------------------------+
| term                              | recovered orientation             |
+===================================+===================================+
| energy                            | ``info["fourc"]["energy"]``       |
+-----------------------------------+-----------------------------------+
| sample name                       | ``info["fourc"]["sample_name"]``  |
+-----------------------------------+-----------------------------------+
| sample lattice                    | ``info["fourc"]["lattice"]``      |
+-----------------------------------+-----------------------------------+
| first reflection                  | ``info["fou                       |
|                                   | rc"]["reflections_details"][0]``: |
|                                   | ``["reflection"]`` and            |
|                                   | ``["position"]``                  |
+-----------------------------------+-----------------------------------+
| second reflection                 | ``info["fou                       |
|                                   | rc"]["reflections_details"][1]``: |
|                                   | ``["reflection"]`` and            |
|                                   | ``["position"]``                  |
+-----------------------------------+-----------------------------------+

The energy and sample info are ready to use. Both the constraints and
reflections info will take a bit of reformatting.

Due to issues with how bluesky writes data, the constraints info was
written with all floating point numbers (including the boolean for the
``fit`` parameter).

1. The order of constraints is exactly the order of the ``_reals`` so
   those associations and conversions must be handled.
2. We can’t just use the dictionaries for ``reflection`` and
   ``position`` in ``info`` since order is important and those are
   recovered in alphabetical order. That’s why the ordered lists for
   *pseudo* and *real* positioners have been saved with the orientation
   information. Those lists provide the canonical order for *any*
   diffractometer geometry.

**Before restoring**, need to check the target diffractometer to see if
it already has these settings.

.. code:: ipython3

    print(f"{info['fourc']['energy'] = }")
    print(f"{info['fourc']['energy_units'] = }")
    print(f"{info['fourc']['energy_offset'] = }")
    print(f"{orange.energy.get() = }")
    print(f"{orange.energy_units.get() = }")
    print(f"{orange.energy_offset.get() = }")
    print()
    print(f"{info['fourc']['sample_name'] = }")
    print(f"{list(orange.calc._samples.keys()) = }")
    print()
    print(f"{orange.calc._samples = }")


.. parsed-literal::

    info['fourc']['energy'] = 8.050922077922078
    info['fourc']['energy_units'] = 'keV'
    info['fourc']['energy_offset'] = 0
    orange.energy.get() = 8.0
    orange.energy_units.get() = 'keV'
    orange.energy_offset.get() = 0
    
    info['fourc']['sample_name'] = 'silicon'
    list(orange.calc._samples.keys()) = ['main']
    
    orange.calc._samples = {'main': HklSample(name='main', lattice=LatticeTuple(a=1.54, b=1.54, c=1.54, alpha=90.0, beta=90.0, gamma=90.0), ux=Parameter(name='None (internally: ux)', limits=(min=-180.0, max=180.0), value=0.0, fit=True, inverted=False, units='Degree'), uy=Parameter(name='None (internally: uy)', limits=(min=-180.0, max=180.0), value=0.0, fit=True, inverted=False, units='Degree'), uz=Parameter(name='None (internally: uz)', limits=(min=-180.0, max=180.0), value=0.0, fit=True, inverted=False, units='Degree'), U=array([[1., 0., 0.],
           [0., 1., 0.],
           [0., 0., 1.]]), UB=array([[ 4.07999046e+00, -2.49827363e-16, -2.49827363e-16],
           [ 0.00000000e+00,  4.07999046e+00, -2.49827363e-16],
           [ 0.00000000e+00,  0.00000000e+00,  4.07999046e+00]]), reflections=[])}


We need to change the energy (units and offset do not need to be
changed), create a new sample, define the two reflections, then compute
**UB**. Then compare that computed **UB** with the recovered value.

Restore the recovered ``fourc`` orientation into ``orange``
-----------------------------------------------------------

.. code:: ipython3

    from hkl.util import restore_orientation
    orange = Fourc("", name="orange")  # TODO: remove this line before publishing
    restore_orientation(info["fourc"], orange)

Compare the **UB** matrices. (Convert the recovered **UB** matrix to a
numpy array to match the type in the diffractometer. Expect ``True`` in
all cells of the 3x3 matrix.)

.. code:: ipython3

    print(f'{np.array(info["fourc"]["UB"]) = }')
    print(f"{orange.UB.get() = }")
    # finally, compare the two matrices cell by cell
    np.array(info["fourc"]["UB"]) == orange.UB.get()


.. parsed-literal::

    np.array(info["fourc"]["UB"]) = array([[-1.41342870e-05, -1.15690713e+00,  7.08409963e-17],
           [ 0.00000000e+00,  0.00000000e+00,  1.15690713e+00],
           [-1.15690713e+00,  1.41342870e-05,  7.08392653e-17]])
    orange.UB.get() = array([[-1.41342870e-05, -1.15690713e+00,  7.08409963e-17],
           [ 0.00000000e+00,  0.00000000e+00,  1.15690713e+00],
           [-1.15690713e+00,  1.41342870e-05,  7.08392653e-17]])




.. parsed-literal::

    array([[ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True]])



.. code:: ipython3

    orange.pa()


.. parsed-literal::

    ===================== ===========================================================================
    term                  value                                                                      
    ===================== ===========================================================================
    diffractometer        orange                                                                     
    geometry              E4CV                                                                       
    class                 Fourc                                                                      
    energy (keV)          8.05092                                                                    
    wavelength (angstrom) 1.54000                                                                    
    calc engine           hkl                                                                        
    mode                  bissector                                                                  
    positions             ===== =======                                                              
                          name  value                                                                
                          ===== =======                                                              
                          omega 0.00000                                                              
                          chi   0.00000                                                              
                          phi   0.00000                                                              
                          tth   0.00000                                                              
                          ===== =======                                                              
    constraints           ===== ========= ========== ===== ====                                      
                          axis  low_limit high_limit value fit                                       
                          ===== ========= ========== ===== ====                                      
                          omega -180.0    180.0      0.0   True                                      
                          chi   -180.0    180.0      0.0   True                                      
                          phi   -180.0    180.0      0.0   True                                      
                          tth   -180.0    180.0      0.0   True                                      
                          ===== ========= ========== ===== ====                                      
    sample: silicon       ================= =========================================================
                          term              value                                                    
                          ================= =========================================================
                          unit cell edges   a=5.4310196, b=5.4310196, c=5.4310196                    
                          unit cell angles  alpha=90.0, beta=90.0, gamma=90.0                        
                          ref 1 (hkl)       h=4.0, k=0.0, l=0.0                                      
                          ref 1 positioners omega=-145.45100, chi=0.00000, phi=0.00000, tth=69.09660 
                          ref 2 (hkl)       h=0.0, k=4.0, l=0.0                                      
                          ref 2 positioners omega=-145.45100, chi=0.00000, phi=90.00000, tth=69.09660
                          [U]               [[-1.22173048e-05 -1.00000000e+00  0.00000000e+00]       
                                             [ 0.00000000e+00  0.00000000e+00  1.00000000e+00]       
                                             [-1.00000000e+00  1.22173048e-05  0.00000000e+00]]      
                          [UB]              [[-1.41342870e-05 -1.15690713e+00  7.08409963e-17]       
                                             [ 0.00000000e+00  0.00000000e+00  1.15690713e+00]       
                                             [-1.15690713e+00  1.41342870e-05  7.08392653e-17]]      
                          ================= =========================================================
    ===================== ===========================================================================
    




.. parsed-literal::

    <pyRestTable.rest_table.Table at 0x7fe3a8de25b0>



Try to restore the recovered ``fourc`` orientation in ``kappa``
---------------------------------------------------------------

Try to share a recovered orientation from ``fourc``, ``scan_id=2`` with
the ``kappa`` diffractometer.

.. code:: ipython3

    try:
        info = run_orientation_info(cat[2])
        restore_orientation(info["fourc"], kappa)
    except ValueError as exc:
        print(f"{exc = }")


.. parsed-literal::

    exc = ValueError('Geometries do not match: Orientation=E4CV, kappa=K4CV, will not restore.')


Restore is not be possible since the geometries are not identical. (To
avoid stopping the notebook with an exception here, we used a
``try..except`` clause.)

Try to create a sample when it already exists
---------------------------------------------

Then, try to restore the sample and lattice when they already exist.

.. code:: ipython3

    from hkl.util import restore_sample
    
    print(f"{kappa.sample_name.get() = }")
    try:
        info = run_orientation_info(cat[2])
        restore_sample(info["fourc"], kappa)
        kappa.wh()
    except Exception as exc:
        print(f"{exc = }")


.. parsed-literal::

    kappa.sample_name.get() = 'silicon'
    exc = ValueError("Sample 'silicon' already exists in kappa.")


Restore the energy
------------------

.. code:: ipython3

    from hkl.util import restore_energy
    
    # make a new kappa, then restore the sample
    kappa = Kappa("", name="kappa")
    print(f"{kappa.sample_name.get() = }")
    try:
        info = run_orientation_info(cat[2])
        restore_energy(info["fourc"], kappa)
        restore_sample(info["fourc"], kappa)
        kappa.wh()
    except Exception as exc:
        print(f"{exc = }")


.. parsed-literal::

    kappa.sample_name.get() = 'main'
    ===================== ========= =========
    term                  value     axis_type
    ===================== ========= =========
    diffractometer        kappa              
    sample name           silicon            
    energy (keV)          8.05092            
    wavelength (angstrom) 1.54000            
    calc engine           hkl                
    mode                  bissector          
    h                     0.0       pseudo   
    k                     0.0       pseudo   
    l                     0.0       pseudo   
    komega                0         real     
    kappa                 0         real     
    kphi                  0         real     
    tth                   0         real     
    ===================== ========= =========
    

