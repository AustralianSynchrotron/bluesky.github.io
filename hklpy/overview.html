

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Overview &mdash; hklpy 0+untagged.1.g7fdad1b.dirty documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Ready-to-Use Devices" href="ready_to_use.html" />
    <link rel="prev" title="hklpy" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> hklpy
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.1.g7fdad1b.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Core Functionality</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#definitions">Definitions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#real-axis-positioner">real axis (positioner)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pseudo-axis-positioner">pseudo axis (positioner)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#forward-transformation">forward (transformation)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inverse-transformation">inverse (transformation)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#libhkl-support-library"><em>libhkl</em> support library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#parts-of-a-diffractometer-object">Parts of a <cite>Diffractometer</cite> object</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#name">name</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geometry">geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calc">calc</a></li>
<li class="toctree-l3"><a class="reference internal" href="#energy">energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sample">sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lattice">lattice</a></li>
<li class="toctree-l3"><a class="reference internal" href="#orientation">orientation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constraint">constraint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode">mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#steps-to-define-a-diffractometer-object">Steps to define a diffractometer object</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Ready-to-Use Devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ready_to_use.html">Ready-to-Use Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release History</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hklpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/overview.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">hklpy</span></code> package provides controls for using diffractometers within the
<a class="reference external" href="https://blueskyproject.io">Bluesky Framework</a>.
<a class="reference internal" href="diffract.html#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Diffractometer()</span></code></a> is the base class from which all the
different diffractometer geometries are built.  Built on the
<a class="reference external" href="https://blueskyproject.io/ophyd/positioners.html#pseudopositioner">ophyd.PseudoPositioner</a> interface,
it defines all the components of a diffractometer.  The different geometries
specify the names and order for the real motor axes.</p>
<div class="section" id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h2>
<p>Several terms used throughout are:</p>
<div class="section" id="real-axis-positioner">
<span id="index-0"></span><h3>real axis (positioner)<a class="headerlink" href="#real-axis-positioner" title="Permalink to this headline">¶</a></h3>
<p>A positioner (whether simulated or attached to hardware) that operates in
<em>real</em> space.  Typically an instance of <a class="reference external" href="https://blueskyproject.io/ophyd/builtin-devices.html#epicsmotor">ophyd.EpicsMotor</a>
or
<a class="reference external" href="https://blueskyproject.io/ophyd/positioners.html#softpositioner">ophyd.SoftPositioner</a>.</p>
</div>
<div class="section" id="pseudo-axis-positioner">
<span id="index-1"></span><h3>pseudo axis (positioner)<a class="headerlink" href="#pseudo-axis-positioner" title="Permalink to this headline">¶</a></h3>
<p>A positioner (whether simulated or attached to hardware) that operates in
<em>reciprocal</em> space.  Typically an instance of <a class="reference external" href="https://blueskyproject.io/ophyd/positioners.html#ophyd.pseudopos.PseudoSingle">ophyd.PseudoSingle</a>.</p>
</div>
<div class="section" id="forward-transformation">
<span id="index-2"></span><h3>forward (transformation)<a class="headerlink" href="#forward-transformation" title="Permalink to this headline">¶</a></h3>
<p>Compute the values of the real positioners given values of the pseudo
positioners.  Since more than one solution is possible, additional
constraints (limits on the real positioner and diffractometer mode) may be
added.</p>
</div>
<div class="section" id="inverse-transformation">
<span id="index-3"></span><h3>inverse (transformation)<a class="headerlink" href="#inverse-transformation" title="Permalink to this headline">¶</a></h3>
<p>Compute the values of the pseudo positioners given values of the real
positioners.</p>
</div>
<div class="section" id="libhkl-support-library">
<span id="index-4"></span><h3><em>libhkl</em> support library<a class="headerlink" href="#libhkl-support-library" title="Permalink to this headline">¶</a></h3>
<p>The transformation between real and reciprocal (_pseudo_) space are passed
(from <a class="reference internal" href="diffract.html#module-hkl.diffract" title="hkl.diffract"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hkl.diffract</span></code></a> through <a class="reference internal" href="calc.html#module-hkl.calc" title="hkl.calc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hkl.calc</span></code></a>) to a support library
known here as <em>libhkl</em> (<a class="reference external" href="https://repo.or.cz/hkl.git">https://repo.or.cz/hkl.git</a>), written in C++.</p>
</div>
</div>
<div class="section" id="parts-of-a-diffractometer-object">
<h2>Parts of a <cite>Diffractometer</cite> object<a class="headerlink" href="#parts-of-a-diffractometer-object" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">Diffractometer</span></code> object has several parts:</p>
<div class="section" id="name">
<h3>name<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">name</span></code> of the <a class="reference internal" href="diffract.html#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Diffractometer()</span></code></a> instance is
completely at the choice of the user and conveys no specific information to
the underlying Python support code.</p>
<p>One important convention is that the name given on the left side of the <code class="docutils literal notranslate"><span class="pre">=</span></code>
matches the name given by the <code class="docutils literal notranslate"><span class="pre">name=&quot;...&quot;</span></code> keyword, such as this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e4cv</span> <span class="o">=</span> <span class="n">E4CV</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e4cv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="geometry">
<span id="index-5"></span><h3>geometry<a class="headerlink" href="#geometry" title="Permalink to this headline">¶</a></h3>
<p>The geometry describes the physical arrangement of real positioners that
make up the diffractometer.  The choices are limited to those geometries
provided in <a class="reference internal" href="geometries.html#module-hkl.geometries" title="hkl.geometries"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hkl.geometries</span></code></a> (which are the geometries provided by the
<em>libhkl</em> support library).  A geometry will provide a list of the real
positioners.  It is possible to use alternate names.</p>
</div>
<div class="section" id="calc">
<span id="index-6"></span><h3>calc<a class="headerlink" href="#calc" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">calc</span></code> attribute, set when the <a class="reference internal" href="diffract.html#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Diffractometer</span></code></a>
object is defined, connects with the underlying <em>libhkl</em> support library.
While a user might call certain methods from this
<a class="reference internal" href="calc.html#hkl.calc.CalcRecip" title="hkl.calc.CalcRecip"><code class="xref py py-class docutils literal notranslate"><span class="pre">CalcRecip()</span></code></a> object, it is usually not necessary.  The
most common term from this layer would be the actual wavelength used for
computations.  Using from the example above, <code class="docutils literal notranslate"><span class="pre">DFRCT.calc.wavelength</span></code>
(where <code class="docutils literal notranslate"><span class="pre">DFRCT</span></code> is the diffractometer object, such as <code class="docutils literal notranslate"><span class="pre">e4cv</span></code> above),
expressed in Angstrom units. Normally, the user will set the energy in the
diffractometer object, <code class="docutils literal notranslate"><span class="pre">DFRCT.energy</span></code>, which will then set the wavelength.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">calc</span></code> contains the methods that convert between energy and
wavelength. To use this Python support at an instrument that does not use
X-rays (such as a neutron source), re-write these methods and also redefine
any classes that use <a class="reference internal" href="calc.html#hkl.calc.CalcRecip" title="hkl.calc.CalcRecip"><code class="xref py py-class docutils literal notranslate"><span class="pre">hkl.calc.CalcRecip()</span></code></a>.</p>
</div>
<div class="section" id="energy">
<span id="index-7"></span><h3>energy<a class="headerlink" href="#energy" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="diffract.html#diffract-energy"><span class="std std-ref">energy</span></a> of the diffractometer sets the
wavelength, which is used when:</p>
<ol class="arabic simple">
<li><p>computing <code class="docutils literal notranslate"><span class="pre">forward()</span></code> and <code class="docutils literal notranslate"><span class="pre">inverse()</span></code> transformations</p></li>
<li><p>defining orientation reflections</p></li>
<li><p>documenting the state of the diffractometer</p></li>
</ol>
<p>It is more common for users to describe energy than wavelength.  The
high-level interface allows the energy to be expressed in any
<a class="reference internal" href="diffract.html#diffract-energy-units"><span class="std std-ref">engineering units</span></a> that are convertible to
the expected units (<cite>keV</cite>).  An offset may be applied, which is useful when
connecting the diffractometer energy with a control system variable.
(See the <a class="reference internal" href="diffract.html#diffract-energy-control-system"><span class="std std-ref">Control System Energy</span></a> section.)</p>
</div>
<div class="section" id="sample">
<span id="index-8"></span><h3>sample<a class="headerlink" href="#sample" title="Permalink to this headline">¶</a></h3>
<p>The point of a diffractometer is to position a sample for scientific
measurements. The <code class="docutils literal notranslate"><span class="pre">sample</span></code> attribute is an instance of
<a class="reference internal" href="sample.html#hkl.sample.HklSample" title="hkl.sample.HklSample"><code class="xref py py-class docutils literal notranslate"><span class="pre">hkl.sample.HklSample</span></code></a>. Behind the scenes, the
<a class="reference internal" href="diffract.html#hkl.diffract.Diffractometer" title="hkl.diffract.Diffractometer"><code class="xref py py-class docutils literal notranslate"><span class="pre">hkl.diffract.Diffractometer</span></code></a> object maintains a <em>dictionary</em> of
samples (keyed by <code class="docutils literal notranslate"><span class="pre">name</span></code>), each with its own <code class="xref py py-class docutils literal notranslate"><span class="pre">hkl.utils.Lattice</span></code>
and orientation (reflections) information.</p>
</div>
<div class="section" id="lattice">
<span id="index-9"></span><h3>lattice<a class="headerlink" href="#lattice" title="Permalink to this headline">¶</a></h3>
<p>Crystal <code class="xref py py-class docutils literal notranslate"><span class="pre">hkl.utils.Lattice</span></code> parameters of unit cell lengths and angles.</p>
</div>
<div class="section" id="orientation">
<span id="index-10"></span><h3>orientation<a class="headerlink" href="#orientation" title="Permalink to this headline">¶</a></h3>
<p>The <strong>UB</strong> matrix describes the <code class="docutils literal notranslate"><span class="pre">forward()</span></code> and <code class="docutils literal notranslate"><span class="pre">inverse()</span></code> transformations
that allow precise positioning of a crystal’s atomic planes in the laboratory
reference system of the diffractometer.  Typically, the <strong>UB</strong> matrix is computed
(by <em>libhkl</em>) from two orientation reflections.</p>
</div>
<div class="section" id="constraint">
<span id="index-11"></span><h3>constraint<a class="headerlink" href="#constraint" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">forward()</span></code> transformation can have many solutions.  A
<a class="reference internal" href="diffract.html#hkl.diffract.Constraint" title="hkl.diffract.Constraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Constraint</span></code></a> can be applied to a real positioner to
limit the range of solutions accepted for that positioner.</p>
</div>
<div class="section" id="mode">
<span id="index-12"></span><h3>mode<a class="headerlink" href="#mode" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">forward()</span></code> transformation can have many solutions.  The
diffractometer is set to a mode (chosen from a list specified by the
diffractometer geometry) that controls how values for each of the real
positioners will be controlled. A mode can control relationships between
real positioners in addition to limiting the motion of a real positioner.
Further, a mode can specify an additional reflection which will be used to
determine the outcome of the <code class="docutils literal notranslate"><span class="pre">forward()</span></code> transformation.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>object</p></th>
<th class="head"><p>meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DFRCT.engine.mode</span></code></p></td>
<td><p>mode selected now</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DFRCT.engine.modes</span></code></p></td>
<td><p>list of possible modes</p></td>
</tr>
</tbody>
</table>
<p>Here, <code class="docutils literal notranslate"><span class="pre">DFRCT</span></code> is the diffractometer object (such as <code class="docutils literal notranslate"><span class="pre">e4cv</span></code> above).</p>
</div>
</div>
<div class="section" id="steps-to-define-a-diffractometer-object">
<h2>Steps to define a diffractometer object<a class="headerlink" href="#steps-to-define-a-diffractometer-object" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Identify the geometry.</p></li>
<li><p>Check that it is supported in  <a class="reference internal" href="geometries.html#module-hkl.geometries" title="hkl.geometries"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hkl.geometries</span></code></a>.</p></li>
<li><p>Create a custom subclass for the diffractometer.</p></li>
<li><p>Connect the real positioners with the control system motors.</p></li>
<li><p>(optional) Connect energy to the control system.</p></li>
<li><p>Define the diffractometer object from the custom subclass.</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="ready_to_use.html" class="btn btn-neutral float-right" title="Ready-to-Use Devices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="hklpy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2014-2021, Brookhaven National Laboratory.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>