

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Epics Signal &mdash; Bluesky Tutorials  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Process Tabular Data with Pandas" href="Process Tabular Data with Pandas.html" />
    <link rel="prev" title="Hello Bluesky: Reading detectors and scanning" href="Hello Bluesky.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Bluesky Tutorials
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Basic Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Hello Python and Jupyter.html">Hello Python and Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hello Bluesky.html">Hello Bluesky: Reading detectors and scanning</a></li>
</ul>
<p class="caption"><span class="caption-text">For Controls Engineers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Epics Signal</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Simulated-Hardware">Simulated Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Hello,-EpicsSignal">Hello, EpicsSignal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Exercise">Exercise</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Read-only">Read-only</a></li>
<li class="toctree-l2"><a class="reference internal" href="#A-read–write-pair">A read–write pair</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Subscribe">Subscribe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Exercise</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-is-put-like-with-a-way-to-know-when-the-action-is-complete."><code class="docutils literal notranslate"><span class="pre">set</span></code> is <code class="docutils literal notranslate"><span class="pre">put</span></code> like with a way to know when the action is complete.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Accessing-the-PV-name-for-debugging">Accessing the PV name for debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#So-many-names">So many names</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">For Scientists</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Process Tabular Data with Pandas.html">Process Tabular Data with Pandas</a></li>
</ul>
<p class="caption"><span class="caption-text">Applied Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="X-ray Absorption Fine Structure/index.html">X-ray Absorption Fine Structure</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Bluesky Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Epics Signal</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Epics Signal.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You can run this notebook in a <a class="reference external" href="https://mybinder.org/v2/gh/bluesky/tutorials/master?urlpath=lab/tree/Epics%20Signal.ipynb">live session</a> <a class="reference external" href="https://mybinder.org/v2/gh/bluesky/tutorials/master?urlpath=lab/tree/Epics%20Signal.ipynb"><img alt="Binder" src="https://mybinder.org/badge.svg" /></a>
or view it <a class="reference external" href="https://nbviewer.jupyter.org/github/bluesky/tutorials/blob/master/Epics%20Signal.ipynb">on nbviewer</a>
or <a class="reference external" href="https://github.com/bluesky/tutorials/blob/master/Epics%20Signal.ipynb">GitHub</a>.</p>
</div>
<div class="section" id="Epics-Signal">
<h1>Epics Signal<a class="headerlink" href="#Epics-Signal" title="Permalink to this headline">¶</a></h1>
<p>In this notebook you will:</p>
<ul class="simple">
<li><p>Connect to some simulated hardware using <code class="docutils literal notranslate"><span class="pre">EpicsSignal</span></code></p></li>
<li><p>Explore the <code class="docutils literal notranslate"><span class="pre">EpicsSignal</span></code> interface.</p></li>
</ul>
<p>Recommend Prerequisites:</p>
<ul class="simple">
<li><p><a class="reference internal" href="Hello Python and Jupyter.html"><span class="doc">Hello Python and Jupyter</span></a></p></li>
</ul>
<div class="section" id="Simulated-Hardware">
<h2>Simulated Hardware<a class="headerlink" href="#Simulated-Hardware" title="Permalink to this headline">¶</a></h2>
<p>Below, we will connect to EPICS IOC(s) controlling simulated hardware in lieu of actual motors, detectors. The IOCs should already be running in the background. Run this command to verify that they are running: it should produce output with RUNNING on each line. In the event of a problem, edit this command to replace <code class="docutils literal notranslate"><span class="pre">status</span></code> with <code class="docutils literal notranslate"><span class="pre">restart</span> <span class="pre">all</span></code> and run again.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>supervisorctl -c supervisor/supervisord.conf status
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
decay                            RUNNING   pid 4974, uptime 0:00:10
mini_beamline                    RUNNING   pid 4975, uptime 0:00:10
random_walk                      RUNNING   pid 4976, uptime 0:00:10
random_walk_horiz                RUNNING   pid 4990, uptime 0:00:08
random_walk_vert                 RUNNING   pid 4991, uptime 0:00:08
simple                           RUNNING   pid 4979, uptime 0:00:10
thermo_sim                       RUNNING   pid 4980, uptime 0:00:10
trigger_with_pc                  RUNNING   pid 4981, uptime 0:00:10
</pre></div></div>
</div>
</div>
<div class="section" id="Hello,-EpicsSignal">
<h2>Hello, EpicsSignal<a class="headerlink" href="#Hello,-EpicsSignal" title="Permalink to this headline">¶</a></h2>
<p>An <code class="docutils literal notranslate"><span class="pre">EpicsSignal</span></code> is ophyd’s representation of a single EPICS channel or a pair of channels, one readable and one writeable.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsSignal</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s1">&#39;simple:A&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EpicsSignal(read_pv=&#39;simple:A&#39;, name=&#39;a&#39;, timestamp=1589241754.5243518, auto_monitor=False, string=False, write_pv=&#39;simple:A&#39;, limits=False, put_complete=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># human-friendly label, which will be encoded in &#39;documents&#39; emitted by bluesky</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;a&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span><span class="o">.</span><span class="n">connected</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;a&#39;: {&#39;value&#39;: 3, &#39;timestamp&#39;: 1589241754.600324}}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;a&#39;: {&#39;source&#39;: &#39;PV:simple:A&#39;,
  &#39;dtype&#39;: &#39;integer&#39;,
  &#39;shape&#39;: [],
  &#39;units&#39;: &#39;&#39;,
  &#39;lower_ctrl_limit&#39;: 0,
  &#39;upper_ctrl_limit&#39;: 0}}
</pre></div></div>
</div>
</div>
<div class="section" id="Exercise">
<h2>Exercise<a class="headerlink" href="#Exercise" title="Permalink to this headline">¶</a></h2>
<p>Instaniate an <code class="docutils literal notranslate"><span class="pre">EpicsSignal</span></code> that is connect to some made-up PV that does not exist, as in:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">broken</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s1">&#39;THIS_IS_NOT_A_THING&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;broken&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>What does <code class="docutils literal notranslate"><span class="pre">broken.connected</span></code> do? What about <code class="docutils literal notranslate"><span class="pre">broken.wait_for_connection()</span></code>? And <code class="docutils literal notranslate"><span class="pre">broken.read()</span></code>?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Read-only">
<h2>Read-only<a class="headerlink" href="#Read-only" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">EpicsSignalRO</span></code> represents a read-only signal. It can’t be put to.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsSignalRO</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">EpicsSignalRO</span><span class="p">(</span><span class="s1">&#39;random_walk:x&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.6481168892760016
</pre></div></div>
</div>
<p>Try putting a value to <code class="docutils literal notranslate"><span class="pre">x</span></code> It will raise a <code class="docutils literal notranslate"><span class="pre">ReadOnlyError</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="A-read–write-pair">
<h2>A read–write pair<a class="headerlink" href="#A-read–write-pair" title="Permalink to this headline">¶</a></h2>
<p>Sometimes the readback and setpoint are different PVs. We can group them into one <code class="docutils literal notranslate"><span class="pre">EpicsSignal</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s1">&#39;thermo:I&#39;</span><span class="p">,</span> <span class="n">write_pv</span><span class="o">=</span><span class="s1">&#39;thermo:SP&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span>
<span class="n">temp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EpicsSignal(read_pv=&#39;thermo:I&#39;, name=&#39;temp&#39;, timestamp=1589241754.6553526, auto_monitor=False, string=False, write_pv=&#39;thermo:SP&#39;, limits=False, put_complete=False)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">temp</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
96.67730694274888
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">temp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">105</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">temp</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
96.67730694274888
</pre></div></div>
</div>
<p>This IOC simulates the oscillations of a temperature controller and will take some time to settle to the desired value. Executing the cell above several times will return varied values. This illustrates the importance of tracking “done”-ness, which we will address in the tutorial on Devices.</p>
<p>More on <code class="docutils literal notranslate"><span class="pre">status</span></code> later.</p>
</div>
<div class="section" id="Subscribe">
<h2>Subscribe<a class="headerlink" href="#Subscribe" title="Permalink to this headline">¶</a></h2>
<p>The actions on an EPICS channel are:</p>
<ul class="simple">
<li><p>read (get)</p></li>
<li><p>write (put)</p></li>
<li><p>monitor (subscribe, “event add”)</p></li>
</ul>
<p>To subscribe is to say, “Send me updates asynchronously whenever the value changes.” To process these changes, we write a function that will be called each time a new value arrives and register than function with the Signal.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">x</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s1">&#39;random_walk:x&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value changed from </span><span class="si">{</span><span class="n">old_value</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="n">token</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Value changed from &lt;object object at 0x7ff88ba08ae0&gt; to 0.6481168892760016.
Value changed from 0.6481168892760016 to 0.6481168892760016.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">token</span>  <span class="c1"># We can use this to unsubscribe.</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">x</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Exercise<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Define and subscribe a callback that prints “+” when the value changes in the positive direction and “-” when it changes in the negative direction.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load</span> solutions/callback_print_sign.py
</pre></div>
</div>
</div>
</div>
<div class="section" id="set-is-put-like-with-a-way-to-know-when-the-action-is-complete.">
<h2><code class="docutils literal notranslate"><span class="pre">set</span></code> is <code class="docutils literal notranslate"><span class="pre">put</span></code> like with a way to know when the action is complete.<a class="headerlink" href="#set-is-put-like-with-a-way-to-know-when-the-action-is-complete." title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">put</span></code> is the low-level method that actually communicates with hardware. <code class="docutils literal notranslate"><span class="pre">set</span></code> is a higher-level method that calls <code class="docutils literal notranslate"><span class="pre">put</span></code> and then tracks when the action initiated by <code class="docutils literal notranslate"><span class="pre">put</span></code> has completed, either by using Channel Access “put completion” or by polling the signal on a background thread.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">temp</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.05</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">273</span><span class="p">)</span>
<span class="n">status</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done!&#39;</span><span class="p">))</span>
<span class="c1"># Wait several seconds and then &#39;done!&#39; will be printed by a background thread.</span>
</pre></div>
</div>
</div>
<p>More about <code class="docutils literal notranslate"><span class="pre">status</span></code> and exactly what is happening here in the notebook on <code class="docutils literal notranslate"><span class="pre">Device</span></code>.</p>
</div>
<div class="section" id="Accessing-the-PV-name-for-debugging">
<h2>Accessing the PV name for debugging<a class="headerlink" href="#Accessing-the-PV-name-for-debugging" title="Permalink to this headline">¶</a></h2>
<p>When we have <em>many</em> signals in play, it can be useful to as a Signal which PV it is connected to (or attempting to connect to).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a</span><span class="o">.</span><span class="n">pvname</span>  <span class="c1"># PV name we gave above</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;simple:A&#39;
</pre></div></div>
</div>
<p>If ophyd is failing to connect, we can try to isolate the problem by using another Channel Access client like <code class="docutils literal notranslate"><span class="pre">caget</span></code> or <code class="docutils literal notranslate"><span class="pre">caproto-get</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>caproto-get <span class="s1">&#39;simple:A&#39;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
simple:A                                  [3]
</pre></div></div>
</div>
<p>We can add verbose output to learn more about which server this is from, etc.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>caproto-get -v <span class="s1">&#39;simple:A&#39;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-blue-fg">[D 00:02:35.407          client:   54]</span> Registering with the Channel Access repeater.
<span class="ansi-blue-fg">[D 00:02:35.409          client:   64]</span> Searching for &#39;simple:A&#39;....
<span class="ansi-blue-fg">[D 00:02:35.413          client:   81]</span> Search request sent to (&#39;255.255.255.255&#39;, 5064).
<span class="ansi-blue-fg">[D 00:02:35.414          client:  121]</span> Found simple:A at (&#39;10.20.0.127&#39;, 5064)
<span class="ansi-green-fg">[I 00:02:35.421          client:  169]</span> [simple:A] simple:A connected
<span class="ansi-blue-fg">[D 00:02:35.421          client:  185]</span> [simple:A] Detected native data_type &lt;ChannelType.LONG: 5&gt;.
simple:A                                  [3]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>caproto-get -vvv <span class="s1">&#39;simple:A&#39;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-blue-fg">[D 00:02:35.740        repeater:  233]</span> Spawning caproto-repeater process....
<span class="ansi-blue-fg">[D 00:02:35.743          client:   54]</span> Registering with the Channel Access repeater.
<span class="ansi-blue-fg">[D 00:02:35.744          client:   64]</span> Searching for &#39;simple:A&#39;....
<span class="ansi-blue-fg">[D 00:02:35.746          client:   81]</span> Search request sent to (&#39;255.255.255.255&#39;, 5064).
<span class="ansi-blue-fg">[D 00:02:35.747          client:  121]</span> Found simple:A at (&#39;10.20.0.127&#39;, 5064)
<span class="ansi-blue-fg">[D 00:02:35.749        _circuit:  161]</span> [10.20.0.127:54452] ---&gt;&gt;&gt; [10.20.0.127:5064] (16B) VersionRequest(priority=0, version=13)
<span class="ansi-blue-fg">[D 00:02:35.750        _circuit:  161]</span> [10.20.0.127:54452] ---&gt;&gt;&gt; [10.20.0.127:5064] (64B) HostNameRequest(name=&#39;travis-job-3ef998b3-85ff-4c93-bbf6-da280cce084b&#39;)
<span class="ansi-blue-fg">[D 00:02:35.751        _circuit:  161]</span> [10.20.0.127:54452] ---&gt;&gt;&gt; [10.20.0.127:5064] (24B) ClientNameRequest(name=&#39;travis&#39;)
<span class="ansi-blue-fg">[D 00:02:35.751        _circuit:  161]</span> [10.20.0.127:54452] ---&gt;&gt;&gt; [10.20.0.127:5064] [simple:A] (32B) CreateChanRequest(name=&#39;simple:A&#39;, cid=0, version=13)
<span class="ansi-blue-fg">[D 00:02:35.751        _circuit:  202]</span> [10.20.0.127:54452] &lt;&lt;&lt;--- [10.20.0.127:5064] (16B) VersionResponse(version=13)
<span class="ansi-blue-fg">[D 00:02:35.799        _circuit:  202]</span> [10.20.0.127:54452] &lt;&lt;&lt;--- [10.20.0.127:5064] (16B) AccessRightsResponse(cid=0, access_rights=&lt;AccessRights.WRITE|READ: 3&gt;)
<span class="ansi-blue-fg">[D 00:02:35.799        _circuit:  202]</span> [10.20.0.127:54452] &lt;&lt;&lt;--- [10.20.0.127:5064] (16B) CreateChanResponse(data_type=&lt;ChannelType.LONG: 5&gt;, data_count=1, cid=0, sid=0)
<span class="ansi-green-fg">[I 00:02:35.799          client:  169]</span> [simple:A] simple:A connected
<span class="ansi-blue-fg">[D 00:02:35.799          client:  185]</span> [simple:A] Detected native data_type &lt;ChannelType.LONG: 5&gt;.
<span class="ansi-blue-fg">[D 00:02:35.800        _circuit:  161]</span> [10.20.0.127:54452] ---&gt;&gt;&gt; [10.20.0.127:5064] (16B) ReadNotifyRequest(data_type=&lt;ChannelType.LONG: 5&gt;, data_count=0, sid=0, ioid=0)
<span class="ansi-blue-fg">[D 00:02:35.801        _circuit:  202]</span> [10.20.0.127:54452] &lt;&lt;&lt;--- [10.20.0.127:5064] (20B) ReadNotifyResponse(data=array([3], dtype=int32), data_type=&lt;ChannelType.LONG: 5&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=0, metadata=None)
<span class="ansi-blue-fg">[D 00:02:35.802        _circuit:  161]</span> [10.20.0.127:54452] ---&gt;&gt;&gt; [10.20.0.127:5064] (16B) ClearChannelRequest(sid=0, cid=0)
simple:A                                  [3]
</pre></div></div>
</div>
</div>
<div class="section" id="So-many-names">
<h2>So many names<a class="headerlink" href="#So-many-names" title="Permalink to this headline">¶</a></h2>
<p>In summary, we have:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">pvname</span></code>, an address for machines</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">name</span></code>, a label for humans and downstream analysis code that wants <code class="docutils literal notranslate"><span class="pre">'temperature'</span></code> not <code class="docutils literal notranslate"><span class="pre">'PV:asdfoijefopefpoaewaopivjapoefijaeftep'</span></code>.</p></li>
<li><p>The name of the variable in Python, the name we use in the code. There could be multiple of these pointing to the same object, as in <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">b</span> <span class="pre">=</span> <span class="pre">EpicsSignal(...)</span></code>.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Process Tabular Data with Pandas.html" class="btn btn-neutral float-right" title="Process Tabular Data with Pandas" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Hello Bluesky.html" class="btn btn-neutral float-left" title="Hello Bluesky: Reading detectors and scanning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Bluesky Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>