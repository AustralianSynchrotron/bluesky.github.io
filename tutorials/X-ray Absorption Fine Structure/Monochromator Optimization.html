

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Monochromator Optimization &mdash; Bluesky Tutorials  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="X-ray Absorption Fine Structure" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Bluesky Tutorials
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Basic Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Hello Python and Jupyter.html">Hello Python and Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Hello Bluesky.html">Hello Bluesky: Reading detectors and scanning</a></li>
</ul>
<p class="caption"><span class="caption-text">For Controls Engineers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Epics Signal.html">Epics Signal</a></li>
</ul>
<p class="caption"><span class="caption-text">For Scientists</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Process Tabular Data with Pandas.html">Process Tabular Data with Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Slice and Interpolate Image Data.html">Slice and Interpolate Image Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Higher Dimensional Data.html">Higher Dimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Multi-dimensional Coordinates.html">Multi-dimensional Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Export data to files with Suitcase.html">Export data to files with Suitcase</a></li>
</ul>
<p class="caption"><span class="caption-text">Applied Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">X-ray Absorption Fine Structure</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Monochromator Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Science-Background">Science Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Running-a-beamline">Running a beamline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Tutorial">Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Moving-to-the-peak-of-the-rocking-curve">Moving to the peak of the rocking curve</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Moving-to-the-center-of-mass-of-the-rocking-curve">Moving to the center of mass of the rocking curve</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Fitting-a-peak-function-to-the-rocking-curve-measurement">Fitting a peak function to the rocking curve measurement</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#In-conclusion">In conclusion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Hierarchies-of-plans-in-BlueSky">Hierarchies of plans in BlueSky</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bluesky Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">X-ray Absorption Fine Structure</a> &raquo;</li>
        
      <li>Monochromator Optimization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/X-ray Absorption Fine Structure/Monochromator Optimization.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You can run this notebook in a <a class="reference external" href="https://mybinder.org/v2/gh/bluesky/tutorials/master?urlpath=lab/tree/X-ray%20Absorption%20Fine%20Structure/Monochromator%20Optimization.ipynb">live session</a> <a class="reference external" href="https://mybinder.org/v2/gh/bluesky/tutorials/master?urlpath=lab/tree/X-ray%20Absorption%20Fine%20Structure/Monochromator%20Optimization.ipynb"><img alt="Binder" src="https://mybinder.org/badge.svg" /></a>
or view it <a class="reference external" href="https://nbviewer.jupyter.org/github/bluesky/tutorials/blob/master/X-ray%20Absorption%20Fine%20Structure/Monochromator%20Optimization.ipynb">on nbviewer</a>
or <a class="reference external" href="https://github.com/bluesky/tutorials/blob/master/X-ray%20Absorption%20Fine%20Structure/Monochromator%20Optimization.ipynb">GitHub</a>.</p>
</div>
<div class="section" id="Monochromator-Optimization">
<h1>Monochromator Optimization<a class="headerlink" href="#Monochromator-Optimization" title="Permalink to this headline">¶</a></h1>
<p>In this notebook you will:</p>
<ul class="simple">
<li><p>Use a custom plan that is tuned to a specific, common task at an XAFS beamline.</p></li>
<li><p>This plan will take some readings, do some prompt analysis on those readings, and then immediately take an action based on the result.</p></li>
</ul>
<div class="section" id="Science-Background">
<h2>Science Background<a class="headerlink" href="#Science-Background" title="Permalink to this headline">¶</a></h2>
<p>Here is a schematic of a double crystal monochromator (DCM), like the one at BMM and many other beamlines. The broadband radiation from the 3-pole wiggler source is incident upon the first crystal of the DCM. At BMM, we most often use a Si(111) DCM and have the option to use Si(311) crystals. The schematic below applies equally well to either crystal type and to any other crystal monochrmoator, as well.</p>
<p>The first crystal monochromates the X-ray beam by Bragg diffraction. The crystal is on a high-preceision rotation stage and the angle between the incident beam and the lattice planes of the crystal is chosen so that a specific wavelength meets the Bragg condition, <span class="math notranslate nohighlight">\(\lambda = 2d\sin(\Theta)\)</span>, where <span class="math notranslate nohighlight">\(d\)</span> is the spacing between the lattice planes of the crystal and <span class="math notranslate nohighlight">\(\Theta\)</span> is the angle between the incident beam and the lattice planes of the first crystal. By changing the angle, we
change the wavelength of the beam diffracting from the first crystal. Because there is a simple relationship between wavelength and energy, we select X-ray energy by changing the angle of the first crystal.</p>
<p><img alt="DCM" src="../_images/doubleb.gif" /> <a class="reference external" href="http://pd.chem.ucl.ac.uk/pdnn/inst2/condit.htm">(image source)</a></p>
<p>The second crystal of the DCM is used to direct the beam downstream, towards the experimental hutch. The second crystal needs to be at the same angle as the first crystal in order to meet the Bragg condition for the wavelength selected by the first crystal. In order to pass the X-rays with high efficiency through the DCM, the first and second crystals must be parallel, within microradians.</p>
<p>Whenever we make a large change in energy – for example, when moving between elements with absorption edge energies that are very far apart – it is prudent to verify that this difference in angle is small. This is done by making a scan of the pitch of the second crustal, monitoring the intensity of the X-ray beam in the experimental hutch. When the second crystal is perfectly parallel to the first crystal, the intensity of the X-rays passing the the onochromator is maximized. Thus this pitch
scan of the second crystal will be a peaked function. We want to place the second crystal pitch at the maximum of this peak.</p>
</div>
<div class="section" id="Running-a-beamline">
<h2>Running a beamline<a class="headerlink" href="#Running-a-beamline" title="Permalink to this headline">¶</a></h2>
<p>BlueSky provides all the tools we need to perform this optimization. Here’s the game plan:</p>
<ol class="arabic simple">
<li><p>Perform a scan of the pitch motor over a range that will include the optimal pitch position</p></li>
<li><p>Record an intensity signal from a detector downstream of the DCM</p></li>
<li><p>When the scan is finished, analyze the intensity measurements and determine the position of peak intensity</p></li>
<li><p>Move the second crystal pitch motor to its optimized position</p></li>
</ol>
<p>BlueSky has you covered. It comes with scan plans that perfom steps 1 and 2. Step 3 is readily implemented using tools from Numerical and Scientific Python. Step 4 is handled by one of BlueSky’s standard motor motion commands. None of this is difficult … <em>except</em> that you need to know some things:</p>
<ul class="simple">
<li><p>The name of the motor to be scanned</p></li>
<li><p>The name of the detector to be monitored</p></li>
<li><p>The syntax of the mathematical tools used to analyze the measured data</p></li>
<li><p>The names of the standard plans for scanning and moving motors</p></li>
</ul>
<p>For the beamline staff, those things should be common knowledge. For a general user or a new post-doc, those things are esoteric mysteries.</p>
<p>Training a user to remember the names of everything and the sequence of commands to run in order to perform this scan is certainly possible, but certainly challanging. At an XAFS beamline, this optimization might be needed dozens of times each day – and it <strong>must</strong> be done correctly <em>every single time</em>. Even a modestly complicated procedure like this optimization becomes a serious friction point in the use of the beamline.</p>
<p>A solution to this friction is make a bespoke measurement plan, tailored to the beamline and constructed from the basic plans provided by BlueSky. That is, we make a plan that performs all the steps of this optimization chore. Thus, instead of training the general user or new post-doc the steps of the optimization, you simply have to train them to run this one plan when it is needed.</p>
<p>In the XAFS community, we usually call this monochromator optimization a “rocking curve scan”. (We are “rocking” the second crystal through its optimal position and measuring the resulting peak-shaped curve.) The <code class="docutils literal notranslate"><span class="pre">rocking_curve()</span></code> plan explained below is used reliably everyday by users and staff at BMM.</p>
</div>
<hr class="docutils" />
<div class="section" id="Tutorial">
<h2>Tutorial<a class="headerlink" href="#Tutorial" title="Permalink to this headline">¶</a></h2>
<p>We start by setting up our BlueSky environment:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> widget
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>
<span class="kn">from</span> <span class="nn">bluesky_tutorial_utils</span> <span class="kn">import</span> <span class="n">setup_data_saving</span>


<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">()</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">setup_data_saving</span><span class="p">(</span><span class="n">RE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We will import a Bluesky <em>plan</em> from a script in the current directory, <a class="reference external" href="./plans.py">plans.py</a>. The plan operates on simulated hardware defined in another script, <a class="reference external" href="./simulated_hardware.py">simulated_hardware.py</a>. For the purposes of this tutorial we do not need to interact with the hardware directly; it’s all done through the plan. You are encouraged to examine <a class="reference external" href="./plans.py">plans.py</a> to understand how the rocking curve scan is implemented.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">plans</span> <span class="kn">import</span> <span class="n">rocking_curve</span>

<span class="n">help</span><span class="p">(</span><span class="n">rocking_curve</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on function rocking_curve in module plans:

rocking_curve(start=-0.1, stop=0.1, nsteps=101, choice=&#39;peak&#39;)
    Perform a relative scan of the DCM 2nd crystal pitch around the current
    position to find the peak of the crystal rocking curve.  Begin by opening
    the hutch slits to 3 mm. At the end, move to the position of maximum
    intensity on I0, then return to the hutch slits to their original height.
    Input:
      start:    (float)  starting position relative to current  [-0.1]
      end:      (float)  ending position relative to current    [0.1]
      nsteps:   (int)    number of steps                        [101]
      choice:   (string) &#39;peak&#39;, fit&#39; or &#39;com&#39; (center of mass) [&#39;peak&#39;]
    If choice is fit, the fit is performed using the
    SkewedGaussianModel from lmfit, which works pretty well for this
    measurement at BMM.  The line shape is a bit skewed due to the
    convolution with the slightly misaligned entrance slits.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "e0f03d120cdf4e64953191d72759502e"}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RE</span><span class="p">(</span><span class="n">rocking_curve</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
rocking curve scan: pitch, I0, -0.100, 0.100, 101 -- starting at 4.000
        uid = bd1b3caf-adf0-40ce-babe-d95b4cf19a2c, scan_id = 1
Found and moved to peak at 4.04 via method peak
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;bd1b3caf-adf0-40ce-babe-d95b4cf19a2c&#39;,)
</pre></div></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">rocking_curve()</span></code> plan performs the scan of the DCM second crystal while monitoring the intensity signal, then analyzes the result to find the position of maximum intensity, and finally moves the second crystal pitch to that position. At this point, the DCM is optimized and the beamline is ready to begin measuring XAFS in the range of the current energy of the DCM.</p>
<p>Now let’s look at a plot of the rocking curve data using matplotlib’s <code class="docutils literal notranslate"><span class="pre">gcf</span></code> (i.e. <a class="reference external" href="https://matplotlib.org/3.2.1/api/_as_gen/matplotlib.pyplot.gcf.html">get current figure</a>) method. At the beamline, this is typically displayed as a live plot during the rocking curve scan.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>  <span class="c1"># Display a snapshot of the current state of the figure.</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/X-ray_Absorption_Fine_Structure_Monochromator_Optimization_7_0.png" src="../_images/X-ray_Absorption_Fine_Structure_Monochromator_Optimization_7_0.png" />
</div>
</div>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">rocking_curve()</span></code> plan simply looks for the position of highest intesity, then moves to that position. In practice, this works quite well at BMM.</p>
<p>There are other ways to examine and interpret a peak-like function. In fact, the <code class="docutils literal notranslate"><span class="pre">rocking_curve()</span></code> plan offers three algorithms for determining the peak position:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">peak</span></code>: find the position of maximum intensity</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">com</span></code>: find the position of the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.center_of_mass.html">center of mass</a> of the masured peak</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code>: fit an analytic function to the measured data and find the centroid of that function. In practice at BMM, we have found that a <a class="reference external" href="https://lmfit.github.io/lmfit-py/builtin_models.html#skewedgaussianmodel">skewed Gaussian function</a> works well.</p></li>
</ol>
<p>Let’s see how these work.</p>
<hr class="docutils" />
<p>First, we need to get the data from the measurement in a form that is convenient to work with. One of the things we set up back in the first step of this tutorial was a “catalog”, i.e. a way of accessing the live data from a measurement. In the step that follows, the <code class="docutils literal notranslate"><span class="pre">run</span></code> vairable will contain the data from the <code class="docutils literal notranslate"><span class="pre">rocking_curve()</span></code> performed above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">run</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">run</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BlueskyRun
  uid=&#39;bd1b3caf-adf0-40ce-babe-d95b4cf19a2c&#39;
  exit_status=&#39;success&#39;
  2020-05-15 13:23:05.014 -- 2020-05-15 13:23:11.038
  Streams:
    * primary

</pre></div></div>
</div>
<p>Access the saved data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

.xr-wrap {
  min-width: 300px;
  max-width: 700px;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><div class='xr-wrap'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-02e5414f-d39c-475e-a5cf-ffd40a20fb67' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-02e5414f-d39c-475e-a5cf-ffd40a20fb67' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 101</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-bedc5665-15b3-4446-84de-aa188a865cfa' class='xr-section-summary-in' type='checkbox'  checked><label for='section-bedc5665-15b3-4446-84de-aa188a865cfa' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.59e+09 1.59e+09 ... 1.59e+09</div><input id='attrs-79134e7b-2ef7-4938-918a-d559ec1a7017' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-79134e7b-2ef7-4938-918a-d559ec1a7017' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-69f6f237-e1a3-46e1-9ad4-674a000b6c19' class='xr-var-data-in' type='checkbox'><label for='data-69f6f237-e1a3-46e1-9ad4-674a000b6c19' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09, 1.589549e+09,
       1.589549e+09])</pre></li></ul></div></li><li class='xr-section-item'><input id='section-62ebee6c-5259-4a48-802a-11c5ed419688' class='xr-section-summary-in' type='checkbox'  checked><label for='section-62ebee6c-5259-4a48-802a-11c5ed419688' class='xr-section-summary' >Data variables: <span>(8)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>I0</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.001037 0.001037 ... 0.5701 0.4802</div><input id='attrs-2f4438bb-33e4-4a00-b667-654cb0ae3ba1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2f4438bb-33e4-4a00-b667-654cb0ae3ba1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-554ce790-9476-4875-bea7-54a2a4a4f9c4' class='xr-var-data-in' type='checkbox'><label for='data-554ce790-9476-4875-bea7-54a2a4a4f9c4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([1.03727341e-03, 1.03727341e-03, 1.03727341e-03, 8.34610961e-04,
       9.24857384e-04, 1.04346785e-03, 1.07517364e-03, 9.54820500e-04,
       1.07894543e-03, 1.17747906e-03, 1.19033370e-03, 1.28335287e-03,
       1.08317675e-03, 1.07198715e-03, 1.41938076e-03, 1.31079474e-03,
       1.30392651e-03, 1.32839380e-03, 1.37866663e-03, 1.36896355e-03,
       1.58811347e-03, 1.82593989e-03, 1.71332825e-03, 1.85248752e-03,
       2.00403568e-03, 1.87879917e-03, 1.92928159e-03, 2.42396953e-03,
       2.83950052e-03, 2.99468772e-03, 3.26737382e-03, 4.44959729e-03,
       8.04585590e-03, 1.62914959e-02, 3.10926156e-02, 5.24777559e-02,
       7.92951983e-02, 1.16950004e-01, 1.62608162e-01, 2.16530134e-01,
       2.73049529e-01, 3.44536643e-01, 4.30735996e-01, 5.24716397e-01,
       6.32706321e-01, 7.53853454e-01, 8.91991150e-01, 1.02045180e+00,
       1.16975129e+00, 1.38058299e+00, 1.61686151e+00, 1.88687493e+00,
       2.23472301e+00, 2.67917774e+00, 3.19842820e+00, 3.88774326e+00,
       4.66676315e+00, 5.58796635e+00, 6.51768910e+00, 7.36206738e+00,
       8.29099441e+00, 9.09568215e+00, 9.89898627e+00, 1.07474555e+01,
       1.15853071e+01, 1.23472935e+01, 1.29691683e+01, 1.35816309e+01,
       1.42412382e+01, 1.47657584e+01, 1.51825360e+01, 1.54152564e+01,
       1.54106799e+01, 1.51267395e+01, 1.46708126e+01, 1.41291701e+01,
       1.34457543e+01, 1.26391738e+01, 1.18269370e+01, 1.09551316e+01,
       1.01354074e+01, 9.29964172e+00, 8.43036426e+00, 7.54936463e+00,
       6.66425341e+00, 5.83844712e+00, 5.04178009e+00, 4.20029861e+00,
       3.45080772e+00, 2.86284243e+00, 2.42551267e+00, 2.09375260e+00,
       1.80942062e+00, 1.57328099e+00, 1.34632652e+00, 1.14790389e+00,
       9.88044001e-01, 8.43324148e-01, 6.90856598e-01, 5.70050163e-01,
       4.80226559e-01])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span>pitch</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.9 3.902 3.904 ... 4.096 4.098 4.1</div><input id='attrs-be520827-abd4-4754-90aa-3317cf2e3333' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-be520827-abd4-4754-90aa-3317cf2e3333' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5ebf5311-91aa-462a-9c91-6c0069b92c34' class='xr-var-data-in' type='checkbox'><label for='data-5ebf5311-91aa-462a-9c91-6c0069b92c34' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([3.9  , 3.902, 3.904, 3.906, 3.908, 3.91 , 3.912, 3.914, 3.916,
       3.918, 3.92 , 3.922, 3.924, 3.926, 3.928, 3.93 , 3.932, 3.934,
       3.936, 3.938, 3.94 , 3.942, 3.944, 3.946, 3.948, 3.95 , 3.952,
       3.954, 3.956, 3.958, 3.96 , 3.962, 3.964, 3.966, 3.968, 3.97 ,
       3.972, 3.974, 3.976, 3.978, 3.98 , 3.982, 3.984, 3.986, 3.988,
       3.99 , 3.992, 3.994, 3.996, 3.998, 4.   , 4.002, 4.004, 4.006,
       4.008, 4.01 , 4.012, 4.014, 4.016, 4.018, 4.02 , 4.022, 4.024,
       4.026, 4.028, 4.03 , 4.032, 4.034, 4.036, 4.038, 4.04 , 4.042,
       4.044, 4.046, 4.048, 4.05 , 4.052, 4.054, 4.056, 4.058, 4.06 ,
       4.062, 4.064, 4.066, 4.068, 4.07 , 4.072, 4.074, 4.076, 4.078,
       4.08 , 4.082, 4.084, 4.086, 4.088, 4.09 , 4.092, 4.094, 4.096,
       4.098, 4.1  ])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span>pitch_setpoint</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.9 3.902 3.904 ... 4.096 4.098 4.1</div><input id='attrs-1c024067-118f-4403-9c1d-19f4a15c4396' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1c024067-118f-4403-9c1d-19f4a15c4396' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6b20706a-810e-451b-9db4-0caf821401b2' class='xr-var-data-in' type='checkbox'><label for='data-6b20706a-810e-451b-9db4-0caf821401b2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([3.9  , 3.902, 3.904, 3.906, 3.908, 3.91 , 3.912, 3.914, 3.916,
       3.918, 3.92 , 3.922, 3.924, 3.926, 3.928, 3.93 , 3.932, 3.934,
       3.936, 3.938, 3.94 , 3.942, 3.944, 3.946, 3.948, 3.95 , 3.952,
       3.954, 3.956, 3.958, 3.96 , 3.962, 3.964, 3.966, 3.968, 3.97 ,
       3.972, 3.974, 3.976, 3.978, 3.98 , 3.982, 3.984, 3.986, 3.988,
       3.99 , 3.992, 3.994, 3.996, 3.998, 4.   , 4.002, 4.004, 4.006,
       4.008, 4.01 , 4.012, 4.014, 4.016, 4.018, 4.02 , 4.022, 4.024,
       4.026, 4.028, 4.03 , 4.032, 4.034, 4.036, 4.038, 4.04 , 4.042,
       4.044, 4.046, 4.048, 4.05 , 4.052, 4.054, 4.056, 4.058, 4.06 ,
       4.062, 4.064, 4.066, 4.068, 4.07 , 4.072, 4.074, 4.076, 4.078,
       4.08 , 4.082, 4.084, 4.086, 4.088, 4.09 , 4.092, 4.094, 4.096,
       4.098, 4.1  ])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span>I0:I0</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.001037 0.001037 ... 0.001037</div><input id='attrs-72b8936d-f989-4887-8841-b500fd05e9ed' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-72b8936d-f989-4887-8841-b500fd05e9ed' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4ec42e77-df89-43a7-bbf4-71657fd2f81b' class='xr-var-data-in' type='checkbox'><label for='data-4ec42e77-df89-43a7-bbf4-71657fd2f81b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727, 0.00103727, 0.00103727, 0.00103727, 0.00103727,
       0.00103727])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span>pitch:pitch_velocity</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 1 1 1 1 1 1 1 ... 1 1 1 1 1 1 1 1</div><input id='attrs-95471af2-89a4-437b-ad42-b2d868ab3e56' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-95471af2-89a4-437b-ad42-b2d868ab3e56' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-319b46c3-aa02-4aa9-98a2-e093b0380e3e' class='xr-var-data-in' type='checkbox'><label for='data-319b46c3-aa02-4aa9-98a2-e093b0380e3e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span>pitch:pitch_acceleration</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 1 1 1 1 1 1 1 ... 1 1 1 1 1 1 1 1</div><input id='attrs-96be5e2f-ab2e-4439-afd1-4418b9d7927d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-96be5e2f-ab2e-4439-afd1-4418b9d7927d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-28b1b875-521b-4fc2-a309-8656e1360842' class='xr-var-data-in' type='checkbox'><label for='data-28b1b875-521b-4fc2-a309-8656e1360842' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
       1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span>seq_num</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4 5 6 ... 96 97 98 99 100 101</div><input id='attrs-9f19ce92-9835-43a2-8b32-bc3f77baeaf4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9f19ce92-9835-43a2-8b32-bc3f77baeaf4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-63948a96-c68e-44e7-9bad-6d7142fff23a' class='xr-var-data-in' type='checkbox'><label for='data-63948a96-c68e-44e7-9bad-6d7142fff23a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([  1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,
        14,  15,  16,  17,  18,  19,  20,  21,  22,  23,  24,  25,  26,
        27,  28,  29,  30,  31,  32,  33,  34,  35,  36,  37,  38,  39,
        40,  41,  42,  43,  44,  45,  46,  47,  48,  49,  50,  51,  52,
        53,  54,  55,  56,  57,  58,  59,  60,  61,  62,  63,  64,  65,
        66,  67,  68,  69,  70,  71,  72,  73,  74,  75,  76,  77,  78,
        79,  80,  81,  82,  83,  84,  85,  86,  87,  88,  89,  90,  91,
        92,  93,  94,  95,  96,  97,  98,  99, 100, 101])</pre></li><li class='xr-var-item'><div class='xr-var-name'><span>uid</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>&lt;U36</div><div class='xr-var-preview xr-preview'>&#x27;75f2fc43-512a-4a2f-9565-8d8d7485e34e&#x27; ... &#x27;6715b769-452a-4b77-89ae-f6787fabfb4e&#x27;</div><input id='attrs-a27f7d77-683b-4a07-8230-fa32b8413ffd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a27f7d77-683b-4a07-8230-fa32b8413ffd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f45706f5-1a1e-40fc-90ab-fea53e7b82c2' class='xr-var-data-in' type='checkbox'><label for='data-f45706f5-1a1e-40fc-90ab-fea53e7b82c2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><pre class='xr-var-data'>array([&#x27;75f2fc43-512a-4a2f-9565-8d8d7485e34e&#x27;,
       &#x27;cadbfa97-1d5c-4339-ad68-a5c2d8a775f3&#x27;,
       &#x27;5f2a810b-de4d-4d36-8f6a-73c5a9738dce&#x27;,
       &#x27;4a5c0be6-d413-4b50-a603-ed3bc1c40052&#x27;,
       &#x27;810f2564-d7da-4680-97eb-9cc1ec6789ae&#x27;,
       &#x27;6d3aba46-53f6-4722-b0a9-6d3a8ed1a4c2&#x27;,
       &#x27;fae7678e-8700-414d-8306-7c822c245341&#x27;,
       &#x27;4ec9c55c-f961-4fb5-85e6-388067b72090&#x27;,
       &#x27;a54d13e7-190f-4f49-8b5b-ab1ad0bcc593&#x27;,
       &#x27;a162cd0c-8ce7-427b-b8d7-df03f67c2098&#x27;,
       &#x27;d28de0c9-c98d-4e0e-9fef-7726cb0e344b&#x27;,
       &#x27;61f897cf-76e6-4f9b-8123-c795ba65352b&#x27;,
       &#x27;ce54e26e-a63f-4855-b08d-c43cff1c5fd7&#x27;,
       &#x27;a6846fba-dfc2-4a90-b9f6-67bee438c251&#x27;,
       &#x27;32daf89e-4d8b-4468-9672-bc18babefbba&#x27;,
       &#x27;01622cf3-7336-48c4-8d1c-cc070ed2a24b&#x27;,
       &#x27;1fd461a0-e1ec-4277-82da-f982e935c863&#x27;,
       &#x27;8bcb140d-ba63-4a13-aa34-6650677962cf&#x27;,
       &#x27;6f1e2c09-8575-464f-a18a-0650cca00cab&#x27;,
       &#x27;74e96466-ffed-4884-9a8d-cb1361078409&#x27;,
       &#x27;f8170b8b-223c-41b6-8457-2a2f42e50a89&#x27;,
       &#x27;95233a72-ab0e-487f-a754-4f06089eb884&#x27;,
       &#x27;4cee31e8-f1d4-4665-a7ad-612d096d91a4&#x27;,
       &#x27;cf6c1f3d-0e6d-40c9-832a-3bf215421cbb&#x27;,
       &#x27;f3eb16d9-834b-46ab-a1f6-dfba1b6aa897&#x27;,
       &#x27;71f420ca-2f0c-47a1-9a7b-82d2a1ee7bd2&#x27;,
       &#x27;58762c51-f5d4-49e9-b417-316f09a6bce8&#x27;,
       &#x27;88e0acfd-8659-4d51-9a94-088e181c3da8&#x27;,
       &#x27;f1fe310c-b909-4558-b298-bd6bbe14c20c&#x27;,
       &#x27;4a40683c-483b-4eb5-b5e4-f49ce1dfeee9&#x27;,
       &#x27;5e30b5f1-6338-4a4f-a857-bc4205b7f797&#x27;,
       &#x27;dddb0a8e-b387-4fb2-9b1a-9c75fc76d5f4&#x27;,
       &#x27;dd97153f-3fd0-4ba7-87ba-0a10e737937b&#x27;,
       &#x27;f1a33d0b-5093-428d-956c-dd3581e4d347&#x27;,
       &#x27;513c8c3b-733a-4cca-8853-29819d4a31ad&#x27;,
       &#x27;44c06c01-0673-441e-b2da-604513adea30&#x27;,
       &#x27;b14582d8-1910-4423-a699-cfa2b12f7932&#x27;,
       &#x27;0073a543-300d-4961-9c90-9690f67e9682&#x27;,
       &#x27;5594ebf8-8278-446f-85ce-4723a9bcbf3b&#x27;,
       &#x27;ee62ae66-cfd8-4df6-b84a-b48d1e6b45b3&#x27;,
       &#x27;c1c3fd1d-e2c8-471e-bc07-79c28cdbe559&#x27;,
       &#x27;37bab75c-1ca2-45d3-a486-7054f64df37e&#x27;,
       &#x27;39ca82b0-9e98-4687-95b2-54d20c6f8a29&#x27;,
       &#x27;7d36172b-38f4-403a-ab98-753b46d4c233&#x27;,
       &#x27;03d7f69b-3973-4ed0-969e-38d71398c80c&#x27;,
       &#x27;1719d151-20e2-4cdb-afef-a1984b318919&#x27;,
       &#x27;0ce04e62-333b-426a-941e-c25ec184194b&#x27;,
       &#x27;f9643e40-044f-40a9-aedc-cde629195799&#x27;,
       &#x27;680aa6f5-5106-4b09-aef7-4c800e15b79f&#x27;,
       &#x27;0871ac7d-3403-4720-a76c-7132a5fa9693&#x27;,
       &#x27;efe4f931-761a-4e30-a485-8c9d316012f6&#x27;,
       &#x27;77b9a5d7-4c32-4db2-bce1-2bc9c7945aee&#x27;,
       &#x27;7a9625cf-1ec7-446b-8dae-27ec76ddba56&#x27;,
       &#x27;2886594e-8203-4c35-8564-b27be7944d3d&#x27;,
       &#x27;126153c3-a8d4-4a55-bc6d-9de70cf534b2&#x27;,
       &#x27;fbed141e-828a-41ec-9165-f617ab87d749&#x27;,
       &#x27;4d41b00c-9707-4a39-be94-f91e8b547a5a&#x27;,
       &#x27;92567851-77e4-40a5-a673-e6456b7c51c9&#x27;,
       &#x27;d6fbd2c8-495d-4e77-adf9-f017b5870054&#x27;,
       &#x27;76321448-88e4-4ebe-9941-41f8c10f0448&#x27;,
       &#x27;0c9a713c-aa83-43a2-9ca2-d564774a5e02&#x27;,
       &#x27;fea117f2-6324-490d-80d2-900350df5127&#x27;,
       &#x27;7739bd40-1882-490a-9e63-93e59dea722d&#x27;,
       &#x27;a1461cf1-15c6-43ca-97d2-3a305f1f1ded&#x27;,
       &#x27;ea57f550-4f01-452e-955f-998ccd112604&#x27;,
       &#x27;ad158ad2-2bda-477f-9252-11ae82150928&#x27;,
       &#x27;a2b687f8-68e5-4c0e-9160-a5c00d8091cf&#x27;,
       &#x27;ce8c50ff-987f-49e5-b9c8-c0228c890f88&#x27;,
       &#x27;961ce832-3a41-4c6b-a85d-f9c98f63bd83&#x27;,
       &#x27;a13eca8f-50b9-4b3c-8123-b429f5fd0922&#x27;,
       &#x27;e68cebc4-9f67-4d3d-a63f-0d25224e4d4e&#x27;,
       &#x27;a4868f5c-ad1c-4f73-87ac-c3542a85a96e&#x27;,
       &#x27;c3e95d6e-bf91-447d-9b2a-aea714e33e49&#x27;,
       &#x27;2c28791d-29a2-42ce-83d9-47af5be8d46a&#x27;,
       &#x27;8087b746-0a4d-4027-9a3c-6d7d7068b024&#x27;,
       &#x27;d417ce91-4866-48a7-9f55-2e958d7de44f&#x27;,
       &#x27;579e054d-6919-42b7-b74c-af2092bba63e&#x27;,
       &#x27;f5994350-a905-4200-b10d-602654bac327&#x27;,
       &#x27;e59454ea-deb3-4a9c-8b17-56b666f6e200&#x27;,
       &#x27;05c936c4-8731-47c6-be47-a1d44b44d5d0&#x27;,
       &#x27;d7b3650a-3109-43cb-96af-7394b42e9cfa&#x27;,
       &#x27;134bd1dc-6ddc-4872-a0a9-e2b7d61dd287&#x27;,
       &#x27;09e48e06-aaf2-4c8a-a363-33861f6df07f&#x27;,
       &#x27;e93af616-2a1d-4713-818a-271ca9a4c1ad&#x27;,
       &#x27;d67eb8f2-62a4-4bbc-af9c-f4dc08319927&#x27;,
       &#x27;0fcbcd38-e3c6-4976-bf4b-d911ee393c4a&#x27;,
       &#x27;ee4d2cef-eb9e-47f2-a1d5-7ec813fb53eb&#x27;,
       &#x27;f8909852-4c1a-4733-9e82-07359bff50f4&#x27;,
       &#x27;a88541d0-7586-4d50-abe6-35fb0931611e&#x27;,
       &#x27;c78b854a-929b-4cc4-a66d-bf409333c4a0&#x27;,
       &#x27;7a2a2abd-fbca-4710-b6df-42d51330856b&#x27;,
       &#x27;e41b94f2-84e8-443e-a062-a3e04a41099f&#x27;,
       &#x27;68ad35dc-7277-4593-a2e5-70aa2da710d5&#x27;,
       &#x27;5360510e-e119-41c7-87cd-ba120c7dbb6f&#x27;,
       &#x27;e8f601b0-21d5-47b7-99cc-c4dae8dbe596&#x27;,
       &#x27;de6d504d-9f91-45f8-8c9b-a42579c06c63&#x27;,
       &#x27;7cabd1c4-1c00-4815-969d-8a50954794b2&#x27;,
       &#x27;a115c3b1-d1bc-48cf-8b6f-4890e6891a77&#x27;,
       &#x27;467a94a4-acd2-43ca-895b-d183d234ae68&#x27;,
       &#x27;9337e2ac-6b34-4715-b756-9fb8a2a79584&#x27;,
       &#x27;6715b769-452a-4b77-89ae-f6787fabfb4e&#x27;], dtype=&#x27;&lt;U36&#x27;)</pre></li></ul></div></li><li class='xr-section-item'><input id='section-3ceebb4d-dd0c-4492-9b0d-ca651485589d' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-3ceebb4d-dd0c-4492-9b0d-ca651485589d' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<p>Plot I0 vs pitch.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>  <span class="c1"># New figure</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "72d7dd52ac2d458790bcf4c51d26bdd8"}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s2">&quot;pitch&quot;</span><span class="p">,</span> <span class="s2">&quot;I0&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>  <span class="c1"># Display a snapshot of the current state of the figure.</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/X-ray_Absorption_Fine_Structure_Monochromator_Optimization_14_0.png" src="../_images/X-ray_Absorption_Fine_Structure_Monochromator_Optimization_14_0.png" />
</div>
</div>
<p>We could have gone straight to the plot in one line by chaining all of this together.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">catalog</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s2">&quot;pitch&quot;</span><span class="p">,</span> <span class="s2">&quot;I0&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>  <span class="c1"># Display a snapshot of the current state of the figure.</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/X-ray_Absorption_Fine_Structure_Monochromator_Optimization_16_0.png" src="../_images/X-ray_Absorption_Fine_Structure_Monochromator_Optimization_16_0.png" />
</div>
</div>
<hr class="docutils" />
<p>The variable <code class="docutils literal notranslate"><span class="pre">data</span></code> contains the result of our just completed rocking curve measurement. The type of this data is <a class="reference external" href="http://xarray.pydata.org/en/stable/generated/xarray.Dataset.html">xarray Dataset</a>. In the following, we will work instead with a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">pandas DataFrame</a>. Here, we convert the xarray Dataset to a pandas DataFrame:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>I0</th>
      <th>pitch</th>
      <th>pitch_setpoint</th>
      <th>I0:I0</th>
      <th>pitch:pitch_velocity</th>
      <th>pitch:pitch_acceleration</th>
      <th>seq_num</th>
      <th>uid</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.589549e+09</th>
      <td>0.001037</td>
      <td>3.900</td>
      <td>3.900</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>75f2fc43-512a-4a2f-9565-8d8d7485e34e</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.001037</td>
      <td>3.902</td>
      <td>3.902</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>cadbfa97-1d5c-4339-ad68-a5c2d8a775f3</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.001037</td>
      <td>3.904</td>
      <td>3.904</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>5f2a810b-de4d-4d36-8f6a-73c5a9738dce</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.000835</td>
      <td>3.906</td>
      <td>3.906</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>4a5c0be6-d413-4b50-a603-ed3bc1c40052</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.000925</td>
      <td>3.908</td>
      <td>3.908</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>5</td>
      <td>810f2564-d7da-4680-97eb-9cc1ec6789ae</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.988044</td>
      <td>4.092</td>
      <td>4.092</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>97</td>
      <td>7cabd1c4-1c00-4815-969d-8a50954794b2</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.843324</td>
      <td>4.094</td>
      <td>4.094</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>98</td>
      <td>a115c3b1-d1bc-48cf-8b6f-4890e6891a77</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.690857</td>
      <td>4.096</td>
      <td>4.096</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>99</td>
      <td>467a94a4-acd2-43ca-895b-d183d234ae68</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.570050</td>
      <td>4.098</td>
      <td>4.098</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>100</td>
      <td>9337e2ac-6b34-4715-b756-9fb8a2a79584</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.480227</td>
      <td>4.100</td>
      <td>4.100</td>
      <td>0.001037</td>
      <td>1</td>
      <td>1</td>
      <td>101</td>
      <td>6715b769-452a-4b77-89ae-f6787fabfb4e</td>
    </tr>
  </tbody>
</table>
<p>101 rows × 8 columns</p>
</div></div>
</div>
<p>Let’s take a slice out of that DataFrame so we can focus on the most relevant parts of this data record, i.e. the values of pitch throughout the scan and the beam intensity at each value of pitch (taken from a detector named <code class="docutils literal notranslate"><span class="pre">I0</span></code>):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">measurement</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;I0&#39;</span><span class="p">,</span> <span class="s1">&#39;pitch&#39;</span><span class="p">]]</span>
<span class="n">measurement</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>I0</th>
      <th>pitch</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.589549e+09</th>
      <td>0.001037</td>
      <td>3.900</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.001037</td>
      <td>3.902</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.001037</td>
      <td>3.904</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.000835</td>
      <td>3.906</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.000925</td>
      <td>3.908</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.988044</td>
      <td>4.092</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.843324</td>
      <td>4.094</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.690857</td>
      <td>4.096</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.570050</td>
      <td>4.098</td>
    </tr>
    <tr>
      <th>1.589549e+09</th>
      <td>0.480227</td>
      <td>4.100</td>
    </tr>
  </tbody>
</table>
<p>101 rows × 2 columns</p>
</div></div>
</div>
<div class="section" id="Moving-to-the-peak-of-the-rocking-curve">
<h3>Moving to the peak of the rocking curve<a class="headerlink" href="#Moving-to-the-peak-of-the-rocking-curve" title="Permalink to this headline">¶</a></h3>
<p>First we find the time index of the data point which has the highest <code class="docutils literal notranslate"><span class="pre">I0</span></code> value, i.e. the peak of the plot above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i0max</span> <span class="o">=</span> <span class="n">measurement</span><span class="p">[</span><span class="s1">&#39;I0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">i0max</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1589548989.3362396
</pre></div></div>
</div>
<p>Now we find the value of pitch at which the <code class="docutils literal notranslate"><span class="pre">I0</span></code> intensity was maximum:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimal_pitch</span> <span class="o">=</span> <span class="n">measurement</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i0max</span><span class="p">,</span> <span class="s1">&#39;pitch&#39;</span><span class="p">]</span>
<span class="n">optimal_pitch</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4.042
</pre></div></div>
</div>
<p>Finally, we want to move the pitch motor to its optimal value. In the <code class="docutils literal notranslate"><span class="pre">rocking_curve()</span></code> plan actually used at BMM, we have a line like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mv</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">optimal_pitch</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="Moving-to-the-center-of-mass-of-the-rocking-curve">
<h3>Moving to the center of mass of the rocking curve<a class="headerlink" href="#Moving-to-the-center-of-mass-of-the-rocking-curve" title="Permalink to this headline">¶</a></h3>
<p>SciPy’s center of mass calculation is an N-dimensional generalization of the sort of gravitational center of mass calculation you might remember from your mechanics class in physics. In this case, the <code class="docutils literal notranslate"><span class="pre">I0</span></code> values at each point of the measurement are used as the “mass” of each position in the array. This way of optimizing the DCM second crystal position might be useful if the measured peak is highly assymetric.</p>
<p>The center of mass calculation will return a real number, not an integer. That is, the center of mass will be between two of the actual measured points. The line below with <code class="docutils literal notranslate"><span class="pre">int(round(</span> <span class="pre">...</span> <span class="pre">))</span></code> returns the index closest to the center of mass, which we then move to. Alternately, you could interpolate to the position of the actual center of mass, but we have opted for the simpler solution here.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy.ndimage.measurements</span> <span class="kn">import</span> <span class="n">center_of_mass</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">measurement</span><span class="p">[</span><span class="s1">&#39;I0&#39;</span><span class="p">])</span>
<span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">center_of_mass</span><span class="p">(</span><span class="n">arr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">val</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
71
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimal_pitch</span> <span class="o">=</span> <span class="n">measurement</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
<span class="n">optimal_pitch</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4.042
</pre></div></div>
</div>
<p>Again, we want to move the pitch motor to its optimal value. So something like like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mv</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">optimal_pitch</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="Fitting-a-peak-function-to-the-rocking-curve-measurement">
<h3>Fitting a peak function to the rocking curve measurement<a class="headerlink" href="#Fitting-a-peak-function-to-the-rocking-curve-measurement" title="Permalink to this headline">¶</a></h3>
<p>Sometimes, when interpreting a peak-like function, it is preferable to bring some more prior knwoeldge to the interpretation. If you know a line shape that provides a good physical description of the measurement, then fitting that line shape might provide you with more information.</p>
<p>Here is how we use <a class="reference external" href="https://lmfit.github.io/lmfit-py/">lmfit</a> to fit a simple skewed Gaussian model to our rocking curve measurement.</p>
<p>First we convert the I0 and pitch columns of the DataFrame to NumPy arrays, which we then feed to lmfit’s skewed Gaussian model. From these, we guess initial parameters. We run the fit, then print the results and prepare a plot showing those results. Finally we set the <code class="docutils literal notranslate"><span class="pre">optimal_pitch</span></code> parameter for use in the same manner as for the peak and center-of-mass interpretations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">lmfit.models</span> <span class="kn">import</span> <span class="n">SkewedGaussianModel</span>
<span class="n">signal</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">measurement</span><span class="p">[</span><span class="s1">&#39;I0&#39;</span><span class="p">])</span>
<span class="n">position</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">measurement</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">])</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">SkewedGaussianModel</span><span class="p">()</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">guess</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">fit_report</span><span class="p">(</span><span class="n">min_correl</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">out</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">optimal_pitch</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">optimal_pitch</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[Model]]
    Model(skewed_gaussian)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 64
    # data points      = 101
    # variables        = 4
    chi-square         = 2.05451858
    reduced chi-square = 0.02118060
    Akaike info crit   = -385.402975
    Bayesian info crit = -374.942493
[[Variables]]
    amplitude:  0.75779889 +/- 0.00212435 (0.28%) (init = 1.017352)
    center:     4.03788513 +/- 0.00480334 (0.12%) (init = 4.042)
    sigma:      0.02048253 +/- 0.00108203 (5.28%) (init = 0.022)
    gamma:      0.28674062 +/- 0.31991513 (111.57%) (init = 0)
[[Correlations]] (unreported correlations are &lt; 0.000)
    C(center, gamma)     = -1.000
    C(center, sigma)     = -0.998
    C(sigma, gamma)      =  0.998
    C(amplitude, sigma)  =  0.074
    C(amplitude, center) = -0.041
    C(amplitude, gamma)  =  0.039
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "226a122e6d4a43b2985d11b8d48143da"}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4.037885131758955
</pre></div></div>
</div>
<p>Finally, we move the pitch motor to its optimal value. So something like like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mv</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">optimal_pitch</span><span class="p">))</span>
</pre></div>
</div>
<p>We can examine the result of the fit by showing the plot:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/X-ray_Absorption_Fine_Structure_Monochromator_Optimization_32_0.png" src="../_images/X-ray_Absorption_Fine_Structure_Monochromator_Optimization_32_0.png" />
</div>
</div>
<p>The peak and center-of-mass algorithms only return the optimal position. An advantage of a fitted analysis of the measurement is that we terms for the amplitide, width, and (in this case) peak assymetry. While we do not need those terms for the purpose of optimizing the rocking curve, in other situations that kind of information might be actionable in a plan like this one.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="In-conclusion">
<h2>In conclusion<a class="headerlink" href="#In-conclusion" title="Permalink to this headline">¶</a></h2>
<p>At BMM, we usually run this rocking curve scan using the peak interpretation. That is the default, so the plan is typically run like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">rocking_curve</span><span class="p">())</span>
</pre></div>
</div>
<p>You can specify the kind of intepretation by using the <code class="docutils literal notranslate"><span class="pre">choice</span></code> argument. This is equivalent to the default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">rocking_curve</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s1">&#39;peak&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Here is the center of mass calculation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">rocking_curve</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s1">&#39;com&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>and here is the fitted interpretation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">rocking_curve</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>You could go way back to the third step of this tutorial and give each a try. You will find that the three give slightly different answers for the optimized position of the DCM second crystal.</p>
<div class="section" id="Hierarchies-of-plans-in-BlueSky">
<h3>Hierarchies of plans in BlueSky<a class="headerlink" href="#Hierarchies-of-plans-in-BlueSky" title="Permalink to this headline">¶</a></h3>
<p>In truth, the rocking curve plan is rarely called directly either by staff or by users at BMM. It is, nonetheless, used many times each day. At BMM, we have a plan called <code class="docutils literal notranslate"><span class="pre">change_edge()</span></code> that is used to automate the reconfiguration of the beamline for measurements in different energy ranges. This plan is how the staff and users typically perform the rocking curve chore.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">change_edge()</span></code> plan requires an argument specifying the element of the next experiment. So, if we want to begin measuring the iron K edge of iron-bearing samples, we do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">change_edge</span><span class="p">(</span><span class="s1">&#39;Fe&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This plan</p>
<ol class="arabic simple">
<li><p>verifies that the photon delivery system is in the correct configuration for the specified energy range</p></li>
<li><p>performs a rocking curve scan just like the one in this tutorial</p></li>
<li><p>optimizes the position of the beam-definition slits</p></li>
<li><p>makes sure detectors are properly configured to make measurements at the chosen absorption edge</p></li>
</ol>
<p>leaving the beamline completely optimized for measurement at the selected absorption edge.</p>
<p>The reason such a magical plan is possible is because, in BlueSky, plans are composed of plans.</p>
<p>Just as the rocking curve plan is built from basic plans (specifically the <code class="docutils literal notranslate"><span class="pre">rel_scan()</span></code> and <code class="docutils literal notranslate"><span class="pre">mv()</span></code> plans), complex user-defined plans are composed of simpler user-defined plans. At BMM, we have plans for each item <code class="docutils literal notranslate"><span class="pre">change_edge()</span></code> chore list. Thus, the <code class="docutils literal notranslate"><span class="pre">change_edge()</span></code> plan is composed of these smaller plans such as <code class="docutils literal notranslate"><span class="pre">rocking_curve()</span></code>.</p>
<p>By building complicated plans out of well-tested, single-purpose plans, we are able to perform automation at the beamline in ways that make the beamline easy to operate for staff and users alike. In fact, at BMM, we allow <em>and</em> encourage our users to run the <code class="docutils literal notranslate"><span class="pre">change_edge()</span></code> command all by themselves!</p>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {"00a3628da2c24fa58a553c111234b6a9": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "e0f03d120cdf4e64953191d72759502e": {"model_name": "MPLCanvasModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_cursor": "default", "_dom_classes": [], "_figure_label": "Figure", "_height": 0, "_image_mode": "diff", "_message": "", "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "MPLCanvasModel", "_rubberband_height": 0, "_rubberband_width": 0, "_rubberband_x": 0, "_rubberband_y": 0, "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "MPLCanvasView", "_width": 0, "footer_visible": true, "header_visible": true, "layout": "IPY_MODEL_00a3628da2c24fa58a553c111234b6a9", "resizable": true, "toolbar": "IPY_MODEL_d5430a7bb67d48f4ab4bafa8701dd07d", "toolbar_position": "left", "toolbar_visible": true}}, "6f60a31d69764654bac277b6367eb7ca": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "d5430a7bb67d48f4ab4bafa8701dd07d": {"model_name": "ToolbarModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_current_action": "", "_dom_classes": [], "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "ToolbarModel", "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "ToolbarView", "button_style": "", "collapsed": true, "layout": "IPY_MODEL_6f60a31d69764654bac277b6367eb7ca", "orientation": "vertical", "toolitems": [["Home", "Reset original view", "home", "home"], ["Back", "Back to previous view", "arrow-left", "back"], ["Forward", "Forward to next view", "arrow-right", "forward"], ["Pan", "Pan axes with left mouse, zoom with right", "arrows", "pan"], ["Zoom", "Zoom to rectangle", "square-o", "zoom"], ["Download", "Download plot", "floppy-o", "save_figure"]]}}, "6da53445a44b4e15be414ac7573f1a38": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "72d7dd52ac2d458790bcf4c51d26bdd8": {"model_name": "MPLCanvasModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_cursor": "pointer", "_dom_classes": [], "_figure_label": "Figure", "_height": 0, "_image_mode": "full", "_message": "", "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "MPLCanvasModel", "_rubberband_height": 0, "_rubberband_width": 0, "_rubberband_x": 0, "_rubberband_y": 0, "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "MPLCanvasView", "_width": 0, "footer_visible": true, "header_visible": true, "layout": "IPY_MODEL_6da53445a44b4e15be414ac7573f1a38", "resizable": true, "toolbar": "IPY_MODEL_623b978b3fa249709e23fa3ed3a496c9", "toolbar_position": "left", "toolbar_visible": true}}, "b4ff8a19b629480e840e5478c527d05a": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "623b978b3fa249709e23fa3ed3a496c9": {"model_name": "ToolbarModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_current_action": "", "_dom_classes": [], "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "ToolbarModel", "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "ToolbarView", "button_style": "", "collapsed": true, "layout": "IPY_MODEL_b4ff8a19b629480e840e5478c527d05a", "orientation": "vertical", "toolitems": [["Home", "Reset original view", "home", "home"], ["Back", "Back to previous view", "arrow-left", "back"], ["Forward", "Forward to next view", "arrow-right", "forward"], ["Pan", "Pan axes with left mouse, zoom with right", "arrows", "pan"], ["Zoom", "Zoom to rectangle", "square-o", "zoom"], ["Download", "Download plot", "floppy-o", "save_figure"]]}}, "730422d4b3ea408f8dabc47972c91686": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "226a122e6d4a43b2985d11b8d48143da": {"model_name": "MPLCanvasModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_cursor": "pointer", "_dom_classes": [], "_figure_label": "Figure", "_height": 0, "_image_mode": "full", "_message": "", "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "MPLCanvasModel", "_rubberband_height": 0, "_rubberband_width": 0, "_rubberband_x": 0, "_rubberband_y": 0, "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "MPLCanvasView", "_width": 0, "footer_visible": true, "header_visible": true, "layout": "IPY_MODEL_730422d4b3ea408f8dabc47972c91686", "resizable": true, "toolbar": "IPY_MODEL_0e2678922b864a1488705f19ef85bc56", "toolbar_position": "left", "toolbar_visible": true}}, "58cd6cac319c4aca802624a8845bb750": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "0e2678922b864a1488705f19ef85bc56": {"model_name": "ToolbarModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_current_action": "", "_dom_classes": [], "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "ToolbarModel", "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "ToolbarView", "button_style": "", "collapsed": true, "layout": "IPY_MODEL_58cd6cac319c4aca802624a8845bb750", "orientation": "vertical", "toolitems": [["Home", "Reset original view", "home", "home"], ["Back", "Back to previous view", "arrow-left", "back"], ["Forward", "Forward to next view", "arrow-right", "forward"], ["Pan", "Pan axes with left mouse, zoom with right", "arrows", "pan"], ["Zoom", "Zoom to rectangle", "square-o", "zoom"], ["Download", "Download plot", "floppy-o", "save_figure"]]}}}, "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="X-ray Absorption Fine Structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Bluesky Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>