

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Exposures and Dark Frames &mdash; Bluesky Tutorials  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Powder Diffraction" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Bluesky Tutorials
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Hello Python and Jupyter.html">Hello Python and Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Hello Bluesky.html">Hello Bluesky: Reading detectors and scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Access Saved Data.html">Access Saved Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Supplemental Data.html">Supplemental Data</a></li>
</ul>
<p class="caption"><span class="caption-text">For Controls Engineers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Epics Signal.html">Epics Signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Anatomy of a Device.html">Anatomy of a Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Flyer Basics.html">Flyer Basics</a></li>
</ul>
<p class="caption"><span class="caption-text">For Scientists</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Process Tabular Data with Pandas.html">Process Tabular Data with Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Slice and Interpolate Image Data.html">Slice and Interpolate Image Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Higher Dimensional Data.html">Higher Dimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Multi-dimensional Coordinates.html">Multi-dimensional Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Live Nonlinear Fitting.html">Live Nonlinear Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Let Us Do the Bookkeeping For You.html">Let Us Do the Bookkeeping For You</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Export data to files with Suitcase.html">Export data to files with Suitcase</a></li>
</ul>
<p class="caption"><span class="caption-text">Applied Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../X-ray Absorption Fine Structure/index.html">X-ray Absorption Fine Structure</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Powder Diffraction</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Exposures and Dark Frames</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Science-Background">Science Background</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Simulated-Beamline">Simulated Beamline</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Setup-Bluesky-&amp;-Simulation">Setup Bluesky &amp; Simulation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Part-1:-Basic-Image-Collection">Part 1: Basic Image Collection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Dark-Images">Dark Images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Integrate-to-get-pattern">Integrate to get pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Using-plans-in-Bluesky-to-gather-light/dark-automatically">Using plans in Bluesky to gather light/dark automatically</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Part-B:-Managing-multiple-samples.">Part B: Managing multiple samples.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Part-C-:-More-samples,-more-problems.">Part C : More samples, more problems.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Success">Success</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bluesky Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Powder Diffraction</a> &raquo;</li>
        
      <li>Exposures and Dark Frames</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Powder Diffraction/Exposures and Dark Frames.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You can run this notebook in a <a class="reference external" href="https://mybinder.org/v2/gh/bluesky/tutorials/master?urlpath=lab/tree/Powder%20Diffraction/Exposures%20and%20Dark%20Frames.ipynb">live session</a> <a class="reference external" href="https://mybinder.org/v2/gh/bluesky/tutorials/master?urlpath=lab/tree/Powder%20Diffraction/Exposures%20and%20Dark%20Frames.ipynb"><img alt="Binder" src="https://mybinder.org/badge.svg" /></a>
or view it <a class="reference external" href="https://nbviewer.jupyter.org/github/bluesky/tutorials/blob/master/Powder%20Diffraction/Exposures%20and%20Dark%20Frames.ipynb">on nbviewer</a>
or <a class="reference external" href="https://github.com/bluesky/tutorials/blob/master/Powder%20Diffraction/Exposures%20and%20Dark%20Frames.ipynb">GitHub</a>.</p>
</div>
<div class="section" id="Exposures-and-Dark-Frames">
<h1>Exposures and Dark Frames<a class="headerlink" href="#Exposures-and-Dark-Frames" title="Permalink to this headline">¶</a></h1>
<p>In this notebook you will: - Learn how to manipulate samples, shutters, and measure on a simulated diffraction beamline - Design and implement a custom scan plan to manage dark-image subtraction - Collect and average the data from multiple exposures</p>
<div class="section" id="Science-Background">
<h2>Science Background<a class="headerlink" href="#Science-Background" title="Permalink to this headline">¶</a></h2>
<p>At high-flux synchrotron lightsources like the NSLS-II, we often employ 2D large area-detectors to quickly gather powder diffraction data by measuring a wide bandwidth of reciprocal-space in a single measurement. In this transmission geometry, the Debye-Scherrer cones are captured as circles on the detector. These 2D images can be azimuthally integrated to process (or reduce) the data from the 2D-image format into the commonly encounter 1-D representation of diffraction peaks as Intensity
vs. momentum-transfer vector (<span class="math notranslate nohighlight">\(Q\)</span>) or Intensity vs. scattering angle (<span class="math notranslate nohighlight">\(2\theta\)</span>).</p>
<p><img alt="Powder Diffraction on an Area Detector" src="../_images/HEX-2D-diffraction.png" /> <a class="reference external" href="https://commons.wikimedia.org/wiki/File:HEX-2D-diffraction.png">(image source)</a></p>
<p>This method of collecting diffraction data has the advantage of being very fast, allowing for in situ diffraction and total scattering studies of materials. For example, we can measure at a 10 Hz frame rate out to <span class="math notranslate nohighlight">\(Q = 25 \, Å^{-1}\)</span> at the PDF Beamline (28-ID-1) at NSLS-II. However, one challenge of this approach is that these large area-detectors often suffer from issues of burn-in, ghosting, and other so-called ‘dark image’ effects on the detectors.</p>
<p>To address many of these issues, we employ a method called dark-image subtraction on the 2D-image data. Put simply, we measure a ‘dark’ image on the detector when there is no light being exposed (i.e. the shutter is closed), in which presumably any static artifacts on the detector are captured. This dark-image is then subtracted from any light-images (which we presume to also have these static artifacts) to produce a final clean image.</p>
<p>Making things more complicated, these dark images must be regularly refreshed during the course of a beamtime. These detectors can experience image-ghosting, particularly from strongly scattering materials or over-exposed images. These ghost-images are essentially residual intensity on the detector that fades slowly with time. Careful management of when to collect dark-images, how to recognize over-exposure, and best practices for efficient data collection are all part of a successful powder
diffraction measurement using 2D area-detectors.</p>
<div class="section" id="Simulated-Beamline">
<h3>Simulated Beamline<a class="headerlink" href="#Simulated-Beamline" title="Permalink to this headline">¶</a></h3>
<p>We have designed a simulated beamline that exhibits a simplified version of these detector effects that can be controlled with Bluesky. Also key to this exercise, we simulated the passage of time and how it effects the image on the detector. This is to say that simply leaving the notebook open will not cause the decay of ghosted after-images on the detector (these effects are not tied to the actual wallclock time). Instead, explicit actions taken will move time forward. The four possible actions
you can take in this tutorial are:</p>
<ul class="simple">
<li><p>Load and unload different several samples</p></li>
<li><p>Open and close a shutter</p></li>
<li><p>Take measurements from the detector</p></li>
<li><p>Take no action for a specific amount of time</p></li>
</ul>
<p>In the case of the latter action (or inaction), you can in principle move backwards in time. However, as “Introductory Time Travel” is saved for a future tutorial, we are recommending against it at this time, and are not responsible for any actions you may take or un-take. It might break the simulation. Please use time travel responsibly.</p>
</div>
<div class="section" id="Setup-Bluesky-&amp;-Simulation">
<h3>Setup Bluesky &amp; Simulation<a class="headerlink" href="#Setup-Bluesky-&-Simulation" title="Permalink to this headline">¶</a></h3>
<p>To begin with, setup your Bluesky environment and import those libraries we will need for the rest of the notebook.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">bluesky_tutorial_utils</span> <span class="kn">import</span> <span class="n">setup_data_saving</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#if you&#39;d prefer interactive plots, comment out the above line, and uncomment below</span>
<span class="c1">#%matplotlib widget</span>

</pre></div>
</div>
</div>
<p>Just as you can often find at real beamlines, we have written a number of custom helper-scripts which execute some of the more complicated raw commands in a more human-friendly way. But, as with real beamlines, you are not limited to the scripts we have provided and could develop your own custom scan-plans or data reduction procedures to gather and analyze data in your own preferred style.</p>
<p>We also setup the Run Engine (RE) and Databroker instance (catalog) here.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">simulated_hardware</span> <span class="kn">import</span> <span class="n">detector</span><span class="p">,</span> <span class="n">load_sample</span><span class="p">,</span> <span class="n">unload_sample</span><span class="p">,</span> <span class="n">light</span><span class="p">,</span> <span class="n">history_reset</span><span class="p">,</span> <span class="n">sim_sleep</span>
<span class="kn">from</span> <span class="nn">simulated_hardware</span> <span class="kn">import</span> <span class="n">_history</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">()</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">setup_data_saving</span><span class="p">(</span><span class="n">RE</span><span class="p">)</span>

<span class="o">%</span><span class="k">run</span> -i utils.py
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Part-1:-Basic-Image-Collection">
<h2>Part 1: Basic Image Collection<a class="headerlink" href="#Part-1:-Basic-Image-Collection" title="Permalink to this headline">¶</a></h2>
<p>To measure a sample, we need to do three things: load the sample into the beamline, open the shutter, and perform a ‘count’ plan on our detector.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#load sample</span>
<span class="n">RE</span><span class="p">(</span><span class="n">load_sample</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="c1">#turn on light</span>
<span class="n">RE</span><span class="p">(</span><span class="n">light</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

<span class="c1">#count</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">detector</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;c28a5d97-3cf7-4794-89e4-fe19d412615a&#39;,)
</pre></div></div>
</div>
<p>Each of these actions takes 0.5 seconds, so if we look at our watch at the end, we should see 1.5 seconds has passed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">look_at_watch</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
the current time is 1.5
</pre></div></div>
</div>
<p>To look at the image we’ve just measured, we’ll use a helper function called <code class="docutils literal notranslate"><span class="pre">retrieve_im</span></code>, which takes as an argument the UID or index number of a run. As we’ve <em>just</em> measured this image, it’ll be the last image added to the Databroker, so we can pass it the argument <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#retrieve image from databroker</span>
<span class="n">my_im</span> <span class="o">=</span> <span class="n">retrieve_im</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">my_im</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.colorbar.Colorbar at 0x7f69b455e9b0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_15_1.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_15_1.png" />
</div>
</div>
<p>We see the diffraction pattern atop the characteristic paneling-effect that is seen on this detector. These panels are the individual modules that make up the large area detector. To get rid of this paneling artifact, we’ll need to measure a dark image.</p>
<div class="section" id="Dark-Images">
<h3>Dark Images<a class="headerlink" href="#Dark-Images" title="Permalink to this headline">¶</a></h3>
<p>To gather our dark image, we need to first close the shutter, wait a bit for the image to decay, and then measure.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RE</span><span class="p">(</span><span class="n">light</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>

<span class="n">sim_sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="c1"># a simulated 15 second pause</span>

<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">detector</span><span class="p">]))</span>

<span class="n">my_dark</span> <span class="o">=</span> <span class="n">retrieve_im</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#the last image will now be our new dark.</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
sleeping for 15
</pre></div></div>
</div>
<p>Now we can look at that dark, and see only the paneling (no diffraction rings).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">my_dark</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7f69ab5b9c18&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_20_1.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_20_1.png" />
</div>
</div>
<p>Finally, look at the result of subtracting this dark from the light image we took earlier.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">my_im</span> <span class="o">-</span> <span class="n">my_dark</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7f69ab59b780&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_22_1.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_22_1.png" />
</div>
</div>
<p>That looks much better! The last thing we’d like to do is integrate this dark-subtracted image in order to reduce our data into a familiar I(Q) form. We’ll use our helper function, <code class="docutils literal notranslate"><span class="pre">simple_integration</span></code> to do this</p>
</div>
<div class="section" id="Integrate-to-get-pattern">
<h3>Integrate to get pattern<a class="headerlink" href="#Integrate-to-get-pattern" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">intensity</span> <span class="o">=</span> <span class="n">simple_integration</span><span class="p">(</span><span class="n">my_im</span> <span class="o">-</span> <span class="n">my_dark</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;measured&#39; data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Q ($\AA^{-1}$)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;I(Q)&#39;</span><span class="p">);</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_25_0.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_25_0.png" />
</div>
</div>
</div>
<div class="section" id="Using-plans-in-Bluesky-to-gather-light/dark-automatically">
<h3>Using plans in Bluesky to gather light/dark automatically<a class="headerlink" href="#Using-plans-in-Bluesky-to-gather-light/dark-automatically" title="Permalink to this headline">¶</a></h3>
<p>Rather than manually performing all the steps we’ve taken thus far, we can write a plan for Bluesky that will perform the same actions we have done thus far. Beamlines will often supply their own ‘common’ set of plans tailored to the experiments performed, but you are free to create your own! These can be as simple or as complicated as you like.</p>
<p>For the workflow design of this simulated enviornment, we are separating out our data collection step from our data reduction step. Recall that when a plan is executed with the Run Engine (RE), the unique identifiers (uid) of the run is returned. We will use that functionality in our data processing workflow here.</p>
<p>In the plan below, <code class="docutils literal notranslate"><span class="pre">dark_light_collection</span></code>, the only required argument is the sample number. We will use more of the complicated features of this plan later in the tutorial.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">dark_light_collection</span><span class="p">(</span><span class="n">sample_num</span><span class="p">,</span> <span class="n">num_lights</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">uids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#close shutter if not already closed</span>
    <span class="k">yield from</span> <span class="n">light</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1">#move to desired sample</span>
    <span class="k">yield from</span> <span class="n">load_sample</span><span class="p">(</span><span class="n">sample_num</span><span class="p">)</span>

    <span class="c1">#take dark image</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">detector</span><span class="p">])</span>
    <span class="n">uids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>

    <span class="c1">#open shutter</span>
    <span class="k">yield from</span> <span class="n">light</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">#take light image</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_lights</span><span class="p">):</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">detector</span><span class="p">])</span>
        <span class="n">uids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>

    <span class="c1">#close shutter to be nice to detector</span>
    <span class="k">yield from</span> <span class="n">light</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">uids</span>
</pre></div>
</div>
</div>
<p>Running this plan will return a tuple of uids, the first of which will be the dark image, and the second the light. Let’s measure the 1st sample, just as we did before.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">uids</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">dark_light_collection</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Now we can look into the variable <code class="docutils literal notranslate"><span class="pre">uids</span></code> that we had the plan return into.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">uids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;0b2c033b-d1dd-4511-a497-6660cce1524e&#39;,
 &#39;d4b102f3-dfb3-403c-ade3-94e91f016ce9&#39;)
</pre></div></div>
</div>
<p>Finally, we’ll take advantage of the data reduction helper-function provided here called <code class="docutils literal notranslate"><span class="pre">process_data</span></code>. This function takes as an argument this tuple of dark/light uid values, will internally do the dark-subtraction and integration, and return the resultant intensity.</p>
<p>We can now plot this, and compare to the pattern we measured before to see that we’ve done the same thing (within measurement noise), but with only a couple lines.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">this_intensity</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">(</span><span class="n">uids</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;hand-measured&#39; data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">this_intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;plan-generated data&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Q ($\AA^{-1}$)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;I(Q)&#39;</span><span class="p">);</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_33_0.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_33_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Part-B:-Managing-multiple-samples.">
<h2>Part B: Managing multiple samples.<a class="headerlink" href="#Part-B:-Managing-multiple-samples." title="Permalink to this headline">¶</a></h2>
<p>Recall that our simulation has multiple samples. If you wanted to look at these different samples, you could load them sequentially into the beamline using the following commands.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RE</span><span class="p">(</span><span class="n">light</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

<span class="n">RE</span><span class="p">(</span><span class="n">load_sample</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">RE</span><span class="p">(</span><span class="n">load_sample</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="n">RE</span><span class="p">(</span><span class="n">load_sample</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
()
</pre></div></div>
</div>
<p>However, recall that this detector has some memory and ghosting issues! Upon reflection, keeping the shutter open while we switched between samples was maybe not the best idea in the world. Let’s take a look at what good-old sample number 1 looks like if we measure it now using our plan.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">uids</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">dark_light_collection</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>First we’ll examing things on the dark-subtracted image. You may notice the problem.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">my_light</span> <span class="o">=</span> <span class="n">retrieve_im</span><span class="p">(</span><span class="n">uids</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">my_dark</span> <span class="o">=</span> <span class="n">retrieve_im</span><span class="p">(</span><span class="n">uids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">my_light</span> <span class="o">-</span> <span class="n">my_dark</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.colorbar.Colorbar at 0x7f69aab555c0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_39_1.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_39_1.png" />
</div>
</div>
<p>Indeed, if we process this data in the standard way, we’ll see negative peaks due to improper dark-image management.</p>
<p>We can pass the kwarg (option) <code class="docutils literal notranslate"><span class="pre">return_light</span> <span class="pre">=</span> <span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">return_dark</span> <span class="pre">=</span> <span class="pre">True</span></code> to our <code class="docutils literal notranslate"><span class="pre">process_data</span></code> function to return those individual components reduced.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">process_data</span><span class="p">(</span><span class="n">uids</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;I(Q)&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">,</span><span class="n">sharex</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">process_data</span><span class="p">(</span><span class="n">uids</span><span class="p">,</span><span class="n">return_light</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">process_data</span><span class="p">(</span><span class="n">uids</span><span class="p">,</span><span class="n">return_dark</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Q ($\AA^{-1}$)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;I(Q)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_41_0.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_41_0.png" />
</div>
</div>
<p>The most straight-forward way to mitigate artifacts such as this is to simply let the ghost-images on the detector fade, and repeat the measurement. Let’s rest for 100 seconds and remeasure sample 1. You can try adjusting the time given in <code class="docutils literal notranslate"><span class="pre">sim_sleep</span></code>, or changing the sample number in <code class="docutils literal notranslate"><span class="pre">dark_light_collection</span></code> to see what effect that has on the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim_sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="n">uids</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">dark_light_collection</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
sleeping for 100
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">process_data</span><span class="p">(</span><span class="n">uids</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;I(Q)&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">,</span><span class="n">sharex</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">process_data</span><span class="p">(</span><span class="n">uids</span><span class="p">,</span><span class="n">return_light</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">process_data</span><span class="p">(</span><span class="n">uids</span><span class="p">,</span><span class="n">return_dark</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Q ($\AA^{-1}$)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;I(Q)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_44_0.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_44_0.png" />
</div>
</div>
</div>
<div class="section" id="Part-C-:-More-samples,-more-problems.">
<h2>Part C : More samples, more problems.<a class="headerlink" href="#Part-C-:-More-samples,-more-problems." title="Permalink to this headline">¶</a></h2>
<p>In a real experiment, you often switch between samples, and they don’t all scatter the same. We often measure multiple times on a single sample and sum the results to improve statistics. Up to now, we’ve been using very ‘friendly’ simulated samples, but let’s crank up the difficulty a little bit. Assume you are now dealing with weakly scattering materials or small-quantities of sample.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hard_mode</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#change to noisy detector</span>
<span class="n">_history</span><span class="p">[</span><span class="s1">&#39;decay_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">_history</span><span class="p">[</span><span class="s1">&#39;noise&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">_history</span><span class="p">[</span><span class="s1">&#39;action_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># 1.0</span>
<span class="n">_history</span><span class="p">[</span><span class="s1">&#39;panel_wl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># 8000</span>
</pre></div>
</div>
</div>
<p>Let’s get a feeling for this new ‘hard mode’ by taking a standard shot as we’ve done before with <code class="docutils literal notranslate"><span class="pre">dark_light_collection</span></code>. We will plot it atop the ideal pattern we’ve already calculated for you called <code class="docutils literal notranslate"><span class="pre">perfect_int1</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">uid</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">dark_light_collection</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">process_data</span><span class="p">(</span><span class="n">uid</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;measured data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">perfect_int1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ideal&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Q ($\AA^{-1}$)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;I(Q)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_49_0.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_49_0.png" />
</div>
</div>
<p>That certainly looks a lot more noisy than before. In situations like this, it’s common to measure the sample multiple times, and sum or average the results. Our <code class="docutils literal notranslate"><span class="pre">dark_light_collection</span></code> plan actually has such a feature in there already. Simply pass the kwarg <code class="docutils literal notranslate"><span class="pre">num_lights=10</span></code> to take 10-consecutive light exposures after the dark.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">uids1</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">dark_light_collection</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_lights</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>We can see the uids1 list now contains 11-entries (the 1-dark, followed by 10-lights).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">uids1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;049e8632-015a-4891-ac59-13f6177545ba&#39;,
 &#39;6c900d6e-57fe-4293-a253-1e3672fd1f3c&#39;,
 &#39;32d2b043-92f4-4702-a374-0eeda83c3721&#39;,
 &#39;880c5cd9-8c1a-4d92-be0b-c99afec985d4&#39;,
 &#39;6bc561a8-d46b-4b31-839b-7be67d736dac&#39;,
 &#39;55a3d36a-5096-46f2-89de-07585fc687ad&#39;,
 &#39;58f6ecc4-ca56-4f7e-8162-50825c4a9617&#39;,
 &#39;95d29475-1912-4fe1-862c-2557122bd45b&#39;,
 &#39;932532fa-f895-4e8b-87af-59858bfedbf6&#39;,
 &#39;ef04a09b-a236-42a7-8ef5-f0c8cca1b8c3&#39;,
 &#39;7cb10a07-9783-448b-8146-c7a31e8b3297&#39;)
</pre></div></div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">process_data</span></code> function is already setup to handle lists of uids like this, simply pass it the same kwarg and it will return you a list of dark-subtraced and reduced intensities.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reduced_data1</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">(</span><span class="n">uids1</span><span class="p">,</span> <span class="n">num_lights</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

</pre></div>
</div>
</div>
<p>Now let’s take the average of those 10 patterns and plot them against the ideal data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">reduced_data1</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean data&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">perfect_int1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;ideal&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Q ($\AA^{-1}$)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;I(Q)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_57_0.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_57_0.png" />
</div>
</div>
<p>While the noise-level seems slightly reduced, you may notice the disturbing trend that the background on our average data is starting to rise. Let’s plot all 10 of these datasets atop each other to see if we can determine why. You may want to turn on interactive plotting at this point to zoom in on the data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> widget
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">reduced_data1</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Q ($\AA^{-1}$)&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;I(Q)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "16adf75d62f14b87a7b030817dd8a3b8"}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_60_1.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_60_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#turning interactive plots off.</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<p>If it’s not clear what is happening yet, we can plot the average of each dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reduced_data1</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;data index&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\sum$ I(Q)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_63_0.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_63_0.png" />
</div>
</div>
<p><strong>We see there is a slowly rising background, which is why our average was corrupted. What is happening?</strong></p>
<p>Unfortunately, just like some of our real detectors, this simulated detector has a slowly varying background. We need to refresh our dark more frequently to account for this!</p>
<p>Here, we will write a custom plan which takes advantage of our previous <code class="docutils literal notranslate"><span class="pre">dark_light_collection</span></code> plan to perform sequential dark/light measurements, with a built-in kwarg-define sleep time to let the ghost-images fade. While we’re being fancy, we’ll also include our data processing function, <code class="docutils literal notranslate"><span class="pre">process_data</span></code>, in the plan to take care of everything in a single step. We’ll append each of those individually reduced dark/light pairs into a new list.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#let detector cool down intially</span>
<span class="n">sim_sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="c1">#define our new list</span>
<span class="n">new_int_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">#define our custom plan</span>
<span class="k">def</span> <span class="nf">custom_plan</span><span class="p">(</span><span class="n">sample_num</span><span class="p">,</span> <span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_loops</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_loops</span><span class="p">):</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;on loop &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">this_pair</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">dark_light_collection</span><span class="p">(</span><span class="n">sample_num</span><span class="p">)</span>
        <span class="n">new_int_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process_data</span><span class="p">(</span><span class="n">this_pair</span><span class="p">))</span>
        <span class="n">sim_sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>

<span class="c1">#excecute the plan with the run engine</span>
<span class="n">RE</span><span class="p">(</span><span class="n">custom_plan</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="n">num_loops</span> <span class="o">=</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1">#turn our new intensity list into a numpy array (because I like numpy arrays more than native python lists)</span>
<span class="n">new_int_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_int_list</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
sleeping for 60
on loop 0
sleeping for 60
on loop 1
sleeping for 60
on loop 2
sleeping for 60
on loop 3
sleeping for 60
on loop 4
sleeping for 60
on loop 5
sleeping for 60
on loop 6
sleeping for 60
on loop 7
sleeping for 60
on loop 8
sleeping for 60
on loop 9
sleeping for 60
</pre></div></div>
</div>
<p>Now compare this to the ideal data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">perfect_int1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ideal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">new_int_list</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;new data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">new_int_list</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">perfect_int1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;diff&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;data index&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\sum$ I(Q)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_67_0.png" src="../_images/Powder_Diffraction_Exposures_and_Dark_Frames_67_0.png" />
</div>
</div>
</div>
<div class="section" id="Success">
<h2>Success<a class="headerlink" href="#Success" title="Permalink to this headline">¶</a></h2>
<p>While python and Bluesky can be a bit of a learning-curve at first, they let the beamline staff <strong>and</strong> users easily develop their own data collection and reduction procedures. Here, we’ve just been using a greatl simplified simulated detector, but demonstrated how some of the more tedious aspects of beamline life can be streamlined with Bluesky.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {"918255e2bf844900b8e29323c0fd2d7d": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "16adf75d62f14b87a7b030817dd8a3b8": {"model_name": "MPLCanvasModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_cursor": "pointer", "_dom_classes": [], "_figure_label": "Figure", "_height": 0, "_image_mode": "full", "_message": "", "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "MPLCanvasModel", "_rubberband_height": 0, "_rubberband_width": 0, "_rubberband_x": 0, "_rubberband_y": 0, "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "MPLCanvasView", "_width": 0, "footer_visible": true, "header_visible": true, "layout": "IPY_MODEL_918255e2bf844900b8e29323c0fd2d7d", "resizable": true, "toolbar": "IPY_MODEL_5d012145314c4d3093423affb97b349e", "toolbar_position": "left", "toolbar_visible": true}}, "3d3e1d4436fd4d42978d2ca7818c4e0c": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "5d012145314c4d3093423affb97b349e": {"model_name": "ToolbarModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_current_action": "", "_dom_classes": [], "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "ToolbarModel", "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "ToolbarView", "button_style": "", "collapsed": true, "layout": "IPY_MODEL_3d3e1d4436fd4d42978d2ca7818c4e0c", "orientation": "vertical", "toolitems": [["Home", "Reset original view", "home", "home"], ["Back", "Back to previous view", "arrow-left", "back"], ["Forward", "Forward to next view", "arrow-right", "forward"], ["Pan", "Pan axes with left mouse, zoom with right", "arrows", "pan"], ["Zoom", "Zoom to rectangle", "square-o", "zoom"], ["Download", "Download plot", "floppy-o", "save_figure"]]}}}, "version_major": 2, "version_minor": 0}
</script></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Powder Diffraction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Bluesky Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>