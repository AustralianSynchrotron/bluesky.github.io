

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Anatomy of a Device &mdash; Bluesky Tutorials  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Flyer Basics" href="Flyer Basics.html" />
    <link rel="prev" title="Epics Signal" href="Epics Signal.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Bluesky Tutorials
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Hello Python and Jupyter.html">Hello Python and Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hello Bluesky.html">Hello Bluesky: Reading detectors and scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Access Saved Data.html">Access Saved Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Supplemental Data.html">Supplemental Data</a></li>
</ul>
<p class="caption"><span class="caption-text">For Controls Engineers</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Epics Signal.html">Epics Signal</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Anatomy of a Device</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Interface-to-Signal">Interface to Signal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Methods-that-require-no-communication-with-the-IOC">Methods that require no communication with the IOC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Methods-that-ask-the-IOC-to-tell-us-something-it-already-‘knows’">Methods that ask the IOC to tell us something it already ‘knows’</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Monitoring-(subscribing-for-updates-asynchronously)">Monitoring (subscribing for updates asynchronously)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Methods-that-ask-the-IOC-to-take-a-(potentially-lengthy)-action">Methods that ask the IOC to take a (potentially lengthy) action</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Interface-of-a-Status-object">Interface of a Status object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Interface-to-Device">Interface to Device</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Names-and-relationships">Names and relationships</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reading-the-parent-combines-the-readings-of-its-children">Reading the parent combines the readings of its children</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Components-are-sorted-into-categories:">Components are sorted into categories:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#‘Staging’-–-a-hook-for-putting-a-device-into-a-controlled-state-for-data-collection-(and-then-putting-it-back)">‘Staging’ – a hook for putting a device into a controlled state for data collection (and then putting it back)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Pseudopositioners">Pseudopositioners</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Flyer Basics.html">Flyer Basics</a></li>
</ul>
<p class="caption"><span class="caption-text">For Scientists</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Process Tabular Data with Pandas.html">Process Tabular Data with Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="Slice and Interpolate Image Data.html">Slice and Interpolate Image Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Higher Dimensional Data.html">Higher Dimensional Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Multi-dimensional Coordinates.html">Multi-dimensional Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="Live Nonlinear Fitting.html">Live Nonlinear Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="Let Us Do the Bookkeeping For You.html">Let Us Do the Bookkeeping For You</a></li>
<li class="toctree-l1"><a class="reference internal" href="Export data to files with Suitcase.html">Export data to files with Suitcase</a></li>
</ul>
<p class="caption"><span class="caption-text">Applied Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="X-ray Absorption Fine Structure/index.html">X-ray Absorption Fine Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="Powder Diffraction/index.html">Powder Diffraction</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Bluesky Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Anatomy of a Device</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Anatomy of a Device.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You can run this notebook in a <a class="reference external" href="https://mybinder.org/v2/gh/bluesky/tutorials/master?urlpath=lab/tree/Anatomy%20of%20a%20Device.ipynb">live session</a> <a class="reference external" href="https://mybinder.org/v2/gh/bluesky/tutorials/master?urlpath=lab/tree/Anatomy%20of%20a%20Device.ipynb"><img alt="Binder" src="https://mybinder.org/badge.svg" /></a>
or view it <a class="reference external" href="https://nbviewer.jupyter.org/github/bluesky/tutorials/blob/master/Anatomy%20of%20a%20Device.ipynb">on nbviewer</a>
or <a class="reference external" href="https://github.com/bluesky/tutorials/blob/master/Anatomy%20of%20a%20Device.ipynb">GitHub</a>.</p>
</div>
<div class="section" id="Anatomy-of-a-Device">
<h1>Anatomy of a Device<a class="headerlink" href="#Anatomy-of-a-Device" title="Permalink to this headline">¶</a></h1>
<p>In this notebook you will:</p>
<ul class="simple">
<li><p>Understand the various methods of an ophyd Signal</p></li>
<li><p>Learn how to group Signals into Devices.</p></li>
<li><p>Learn how to specific “pseudopositions” that expose real axes (corresponding to physical hardware) and pseudoaxes, that move real axes via some mathematical transformation.</p></li>
</ul>
<p>Recommended Prerequisites:</p>
<ul class="simple">
<li><p><a class="reference internal" href="Hello Bluesky.html"><span class="doc">Hello Bluesky</span></a></p></li>
</ul>
<div class="section" id="Configuration">
<h2>Configuration<a class="headerlink" href="#Configuration" title="Permalink to this headline">¶</a></h2>
<p>Below, we will connect to EPICS IOC(s) controlling simulated hardware in lieu of actual motors, detectors. The IOCs should already be running in the background. Run this command to verify that they are running: it should produce output with RUNNING on each line. In the event of a problem, edit this command to replace <code class="docutils literal notranslate"><span class="pre">status</span></code> with <code class="docutils literal notranslate"><span class="pre">restart</span> <span class="pre">all</span></code> and run again.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>supervisorctl -c supervisor/supervisord.conf status
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
decay                            RUNNING   pid 5026, uptime 0:00:17
mini_beamline                    RUNNING   pid 5027, uptime 0:00:17
random_walk                      RUNNING   pid 5028, uptime 0:00:17
random_walk_horiz                RUNNING   pid 5029, uptime 0:00:17
random_walk_vert                 RUNNING   pid 5030, uptime 0:00:17
simple                           RUNNING   pid 5031, uptime 0:00:17
thermo_sim                       RUNNING   pid 5032, uptime 0:00:17
trigger_with_pc                  RUNNING   pid 5033, uptime 0:00:17
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">run</span> scripts/beamline_configuration.py
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/virtualenv/python3.7.1/lib/python3.7/site-packages/pims/image_reader.py:26: RuntimeWarning: PIMS image_reader.py could not find scikit-image. Falling back to matplotlib&#39;s imread(), which uses floats instead of integers. This may break your scripts.
(To ignore this warning, include the line &#34;warnings.simplefilter(&#34;ignore&#34;, RuntimeWarning)&#34; in your script.)
  warnings.warn(RuntimeWarning(ski_preferred))
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Device</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">Component</span> <span class="k">as</span> <span class="n">Cpt</span><span class="p">,</span> <span class="n">DeviceStatus</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">SynSignal</span><span class="p">,</span> <span class="n">SynPeriodicSignal</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Interface-to-Signal">
<h2>Interface to Signal<a class="headerlink" href="#Interface-to-Signal" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sig&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sig</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Signal(name=&#39;sig&#39;, value=3, timestamp=1593895041.9971492)
</pre></div></div>
</div>
<div class="section" id="Methods-that-require-no-communication-with-the-IOC">
<h3>Methods that require no communication with the IOC<a class="headerlink" href="#Methods-that-require-no-communication-with-the-IOC" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;sig&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
</div>
<div class="section" id="Methods-that-ask-the-IOC-to-tell-us-something-it-already-‘knows’">
<h3>Methods that ask the IOC to tell us something it already ‘knows’<a class="headerlink" href="#Methods-that-ask-the-IOC-to-tell-us-something-it-already-‘knows’" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span><span class="o">.</span><span class="n">connected</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span><span class="o">.</span><span class="n">limits</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0, 0)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;sig&#39;: {&#39;value&#39;: 3, &#39;timestamp&#39;: 1593895041.9971492}}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;sig&#39;: {&#39;source&#39;: &#39;SIM:sig&#39;, &#39;dtype&#39;: &#39;integer&#39;, &#39;shape&#39;: []}}
</pre></div></div>
</div>
</div>
<div class="section" id="Monitoring-(subscribing-for-updates-asynchronously)">
<h3>Monitoring (subscribing for updates asynchronously)<a class="headerlink" href="#Monitoring-(subscribing-for-updates-asynchronously)" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">cb</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="o">**</span><span class="n">a_whole_bunch_of_junk</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;changed from </span><span class="si">{</span><span class="n">old_value</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">sig</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="c1"># The act of subscribing always generates one reading immediately...</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>If this were an <code class="docutils literal notranslate"><span class="pre">EpicsSignal</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">Signal</span></code>, <code class="docutils literal notranslate"><span class="pre">cb</span></code> would be called from a thread every time pyepics receives a new update about the value of <code class="docutils literal notranslate"><span class="pre">sig</span></code>. In this case, we have to update it manually.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
changed from 3 to 5
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
changed from 5 to 10
</pre></div></div>
</div>
<p>Or we can connect to the <code class="docutils literal notranslate"><span class="pre">random_walk</span></code> IOC which publishes a new updates at a regular interval.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsSignal</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s1">&#39;random_walk:x&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rand&#39;</span><span class="p">)</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rand</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Methods-that-ask-the-IOC-to-take-a-(potentially-lengthy)-action">
<h3>Methods that ask the IOC to take a (potentially lengthy) action<a class="headerlink" href="#Methods-that-ask-the-IOC-to-take-a-(potentially-lengthy)-action" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">cb</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished at t =&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

<span class="n">status</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">status</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
changed from 10 to 5
finished at t = 1593895042.079715
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/virtualenv/python3.7.1/lib/python3.7/site-packages/ipykernel_launcher.py:5: DeprecationWarning: The signature of a Status callback is now expected to be cb(status). The signature cb() is supported, but support will be removed in a future release of ophyd.
  &#34;&#34;&#34;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Status(obj=Signal(name=&#39;sig&#39;, value=5, timestamp=1593895042.0786636), done=True, success=True)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span><span class="o">.</span><span class="n">done</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>
<span class="n">status</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/virtualenv/python3.7.1/lib/python3.7/site-packages/ipykernel_launcher.py:2: DeprecationWarning: The signature of a Status callback is now expected to be cb(status). The signature cb() is supported, but support will be removed in a future release of ophyd.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
finished at t = 1593895042.1062956
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Interface-of-a-Status-object">
<h2>Interface of a Status object<a class="headerlink" href="#Interface-of-a-Status-object" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span> <span class="o">=</span> <span class="n">DeviceStatus</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span><span class="o">.</span><span class="n">done</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span><span class="o">.</span><span class="n">success</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">cb</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BOOM&quot;</span><span class="p">)</span>

<span class="n">status</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/virtualenv/python3.7.1/lib/python3.7/site-packages/ipykernel_launcher.py:4: DeprecationWarning: The signature of a Status callback is now expected to be cb(status). The signature cb() is supported, but support will be removed in a future release of ophyd.
  after removing the cwd from sys.path.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span><span class="o">.</span><span class="n">callbacks</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
deque([&lt;function ophyd.utils.adapt_old_callback_signature.&lt;locals&gt;.callback(status)&gt;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span><span class="o">.</span><span class="n">device</span>  <span class="c1"># the Device or Signal that the Status pertains to</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Signal(name=&#39;sig&#39;, value=5, timestamp=1593895042.0786636)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span><span class="o">.</span><span class="n">_finished</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BOOM
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span><span class="o">.</span><span class="n">done</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status</span><span class="o">.</span><span class="n">success</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Failure looks like this:</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">DeviceStatus</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
<span class="n">status</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="n">status</span><span class="o">.</span><span class="n">_finished</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">status</span><span class="o">.</span><span class="n">success</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/virtualenv/python3.7.1/lib/python3.7/site-packages/ipykernel_launcher.py:3: DeprecationWarning: The signature of a Status callback is now expected to be cb(status). The signature cb() is supported, but support will be removed in a future release of ophyd.
  This is separate from the ipykernel package so we can avoid doing imports until
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BOOM
</pre></div></div>
</div>
<p>We’ll see later how to actually use this in practice.</p>
</div>
<div class="section" id="Interface-to-Device">
<h2>Interface to Device<a class="headerlink" href="#Interface-to-Device" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># This encodes the _structure_ of a kind of Device.</span>
<span class="c1"># Real examples include EpicsMotor, EpicsScaler or user-defined</span>
<span class="c1"># combinations of these, such as a platform that can move in X and Y.</span>

<span class="k">class</span> <span class="nc">Platform</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p1&#39;</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Names-and-relationships">
<h3>Names and relationships<a class="headerlink" href="#Names-and-relationships" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Platform(prefix=&#39;&#39;, name=&#39;p1&#39;, read_attrs=[&#39;x&#39;, &#39;y&#39;], configuration_attrs=[])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">component_names</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;x&#39;, &#39;y&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Signal(name=&#39;p1_x&#39;, parent=&#39;p1&#39;, value=3, timestamp=1593895042.187344)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">y</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Signal(name=&#39;p1_y&#39;, parent=&#39;p1&#39;, value=4, timestamp=1593895042.187417)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;p1&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;p1_x&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="n">p1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
</div>
<div class="section" id="Reading-the-parent-combines-the-readings-of-its-children">
<h3>Reading the parent combines the readings of its children<a class="headerlink" href="#Reading-the-parent-combines-the-readings-of-its-children" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;p1_x&#39;, {&#39;value&#39;: 3, &#39;timestamp&#39;: 1593895042.187344}),
             (&#39;p1_y&#39;, {&#39;value&#39;: 4, &#39;timestamp&#39;: 1593895042.187417})])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;p1_x&#39;: {&#39;value&#39;: 3, &#39;timestamp&#39;: 1593895042.187344}}
</pre></div></div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">describe</span></code> works exactly the same way:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;p1_x&#39;, {&#39;source&#39;: &#39;SIM:p1_x&#39;, &#39;dtype&#39;: &#39;integer&#39;, &#39;shape&#39;: []}),
             (&#39;p1_y&#39;,
              {&#39;source&#39;: &#39;SIM:p1_y&#39;, &#39;dtype&#39;: &#39;integer&#39;, &#39;shape&#39;: []})])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;p1_x&#39;: {&#39;source&#39;: &#39;SIM:p1_x&#39;, &#39;dtype&#39;: &#39;integer&#39;, &#39;shape&#39;: []}}
</pre></div></div>
</div>
</div>
<div class="section" id="Components-are-sorted-into-categories:">
<h3>Components are sorted into categories:<a class="headerlink" href="#Components-are-sorted-into-categories:" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OMITTED</span></code> – not read (exposed for debugging only)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NORMAL</span></code> / <code class="docutils literal notranslate"><span class="pre">read_attrs</span></code> – things to read once per Event (i.e. row in the table)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG</span></code> / <code class="docutils literal notranslate"><span class="pre">configuration_attrs</span></code> – things to read once per Event Descriptor (which usually means one per run)</p></li>
<li><p>things ommitted from data collection entirely, but available for debugging etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HINTED</span></code> – subset of <code class="docutils literal notranslate"><span class="pre">NORMAL</span></code> flagged as interesting</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">read_attrs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;x&#39;, &#39;y&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">configuration_attrs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># dumb example...</span>

<span class="k">class</span> <span class="nc">Platform</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">motion_compensation</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;CONFIG&#39;</span><span class="p">)</span>  <span class="c1"># a boolean</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p1&#39;</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">read_attrs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;x&#39;, &#39;y&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">configuration_attrs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;motion_compensation&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">read_configuration</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;p1_motion_compensation&#39;,
              {&#39;value&#39;: 1, &#39;timestamp&#39;: 1593895042.2858725})])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">describe_configuration</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
OrderedDict([(&#39;p1_motion_compensation&#39;,
              {&#39;source&#39;: &#39;SIM:p1_motion_compensation&#39;,
               &#39;dtype&#39;: &#39;integer&#39;,
               &#39;shape&#39;: []})])
</pre></div></div>
</div>
<p>The data from <code class="docutils literal notranslate"><span class="pre">configuration_attrs</span></code> isn’t displayed by the built-in callbacks…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">p1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2020-07-04 20:37:22
Persistent Unique Scan ID: &#39;75b04a2c-3760-46ab-b5d2-e4f5bbfad4d8&#39;
New stream: &#39;primary&#39;
+-----------+------------+
|   seq_num |       time |
+-----------+------------+
|         1 | 20:37:22.3 |
+-----------+------------+
generator count [&#39;75b04a2c&#39;] (scan num: 1)



</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;75b04a2c-3760-46ab-b5d2-e4f5bbfad4d8&#39;,)
</pre></div></div>
</div>
<p>… but the data is saved, and it can accessed conveniently like so:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">h</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">h</span><span class="o">.</span><span class="n">config_data</span><span class="p">(</span><span class="s1">&#39;p1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;primary&#39;: [{&#39;p1_motion_compensation&#39;: 1}]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
data keys (* hints)
-------------------
 p1_x
 p1_y

read attrs
----------
x                    Signal              (&#39;p1_x&#39;)
y                    Signal              (&#39;p1_y&#39;)

config keys
-----------
p1_motion_compensation

configuration attrs
-------------------
motion_compensation  Signal              (&#39;p1_motion_compensation&#39;)

unused attrs
------------

</pre></div></div>
</div>
<p>Hints are meant to help downstream consumers of the data correctly infer user intent and automatically construct useful views on the data. They are only a suggestion. <em>They do not affect what is saved.</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># dumb example...</span>

<span class="k">class</span> <span class="nc">Platform</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hinted&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hinted&#39;</span><span class="p">)</span>
    <span class="n">motion_compensation</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;config&#39;</span><span class="p">)</span>  <span class="c1"># a boolean</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p1&#39;</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">hints</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;fields&#39;: [&#39;p1_x&#39;, &#39;p1_y&#39;]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
data keys (* hints)
-------------------
*p1_x
*p1_y

read attrs
----------
x                    Signal              (&#39;p1_x&#39;)
y                    Signal              (&#39;p1_y&#39;)

config keys
-----------
p1_motion_compensation

configuration attrs
-------------------
motion_compensation  Signal              (&#39;p1_motion_compensation&#39;)

unused attrs
------------

</pre></div></div>
</div>
</div>
<div class="section" id="‘Staging’-–-a-hook-for-putting-a-device-into-a-controlled-state-for-data-collection-(and-then-putting-it-back)">
<h3>‘Staging’ – a hook for putting a device into a controlled state for data collection (and then putting it back)<a class="headerlink" href="#‘Staging’-–-a-hook-for-putting-a-device-into-a-controlled-state-for-data-collection-(and-then-putting-it-back)" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">Platform</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">_default_configuration_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;motion_compensation&#39;</span><span class="p">,)</span>
    <span class="n">_default_read_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">motion_compensation</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># a boolean</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="p">[</span><span class="s1">&#39;motion_compensation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>


<span class="n">p1</span> <span class="o">=</span> <span class="n">Platform</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">motion_compensation</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">motion_compensation</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Device.stage()</span></code> stashes the current state of the signals in <code class="docutils literal notranslate"><span class="pre">stage_sigs</span></code> and then puts the device into the desired state.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">stage</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Platform(prefix=&#39;&#39;, name=&#39;p1&#39;, read_attrs=[&#39;x&#39;, &#39;y&#39;], configuration_attrs=[&#39;motion_compensation&#39;])]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">motion_compensation</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Device.unstage()</span></code> uses that stashed stage to put everything back.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">unstage</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Platform(prefix=&#39;&#39;, name=&#39;p1&#39;, read_attrs=[&#39;x&#39;, &#39;y&#39;], configuration_attrs=[&#39;motion_compensation&#39;])]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">motion_compensation</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>Staging twice is illegal:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">stage</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Platform(prefix=&#39;&#39;, name=&#39;p1&#39;, read_attrs=[&#39;x&#39;, &#39;y&#39;], configuration_attrs=[&#39;motion_compensation&#39;])]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># THIS IS EXPECTED TO CREATE AN ERROR.</span>

<span class="n">p1</span><span class="o">.</span><span class="n">stage</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RedundantStaging</span>                          Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-62-acdfc37e2a79&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg"># THIS IS EXPECTED TO CREATE AN ERROR.</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>p1<span class="ansi-blue-fg">.</span>stage<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/virtualenv/python3.7.1/lib/python3.7/site-packages/ophyd/device.py</span> in <span class="ansi-cyan-fg">stage</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    516</span>         <span class="ansi-green-fg">elif</span> self<span class="ansi-blue-fg">.</span>_staged <span class="ansi-blue-fg">==</span> Staged<span class="ansi-blue-fg">.</span>yes<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    517</span>             raise RedundantStaging(&#34;Device {!r} is already staged. &#34;
<span class="ansi-green-fg">--&gt; 518</span><span class="ansi-red-fg">                                    &#34;Unstage it first.&#34;.format(self))
</span><span class="ansi-green-intense-fg ansi-bold">    519</span>         <span class="ansi-green-fg">elif</span> self<span class="ansi-blue-fg">.</span>_staged <span class="ansi-blue-fg">==</span> Staged<span class="ansi-blue-fg">.</span>partially<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    520</span>             raise RedundantStaging(&#34;Device {!r} has been partially staged. &#34;

<span class="ansi-red-fg">RedundantStaging</span>: Device Platform(prefix=&#39;&#39;, name=&#39;p1&#39;, read_attrs=[&#39;x&#39;, &#39;y&#39;], configuration_attrs=[&#39;motion_compensation&#39;]) is already staged. Unstage it first.
</pre></div></div>
</div>
<p>But unstaging is indempotent:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p1</span><span class="o">.</span><span class="n">unstage</span><span class="p">()</span>
<span class="n">p1</span><span class="o">.</span><span class="n">unstage</span><span class="p">()</span>
<span class="n">p1</span><span class="o">.</span><span class="n">unstage</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Platform(prefix=&#39;&#39;, name=&#39;p1&#39;, read_attrs=[&#39;x&#39;, &#39;y&#39;], configuration_attrs=[&#39;motion_compensation&#39;])]
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Pseudopositioners">
<h2>Pseudopositioners<a class="headerlink" href="#Pseudopositioners" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="p">(</span><span class="n">PseudoPositioner</span><span class="p">,</span> <span class="n">PseudoSingle</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">ophyd.pseudopos</span> <span class="kn">import</span> <span class="p">(</span><span class="n">pseudo_position_argument</span><span class="p">,</span>
                             <span class="n">real_position_argument</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">SoftPositioner</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">Cpt</span>

<span class="k">class</span> <span class="nc">SPseudo3x3</span><span class="p">(</span><span class="n">PseudoPositioner</span><span class="p">):</span>
    <span class="n">pseudo1</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">egu</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">pseudo2</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">egu</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">pseudo3</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">egu</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>

    <span class="n">real1</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">,</span> <span class="n">init_pos</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">real2</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">,</span> <span class="n">init_pos</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">real3</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">,</span> <span class="n">init_pos</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

    <span class="n">sig</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">Signal</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@pseudo_position_argument</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pseudo_pos</span><span class="p">):</span>
        <span class="c1"># logger.debug(&#39;forward %s&#39;, pseudo_pos)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RealPosition</span><span class="p">(</span><span class="n">real1</span><span class="o">=-</span><span class="n">pseudo_pos</span><span class="o">.</span><span class="n">pseudo1</span><span class="p">,</span>
                                    <span class="n">real2</span><span class="o">=-</span><span class="n">pseudo_pos</span><span class="o">.</span><span class="n">pseudo2</span><span class="p">,</span>
                                    <span class="n">real3</span><span class="o">=-</span><span class="n">pseudo_pos</span><span class="o">.</span><span class="n">pseudo3</span><span class="p">)</span>

    <span class="nd">@real_position_argument</span>
    <span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">real_pos</span><span class="p">):</span>
        <span class="c1"># logger.debug(&#39;inverse %s&#39;, real_pos)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PseudoPosition</span><span class="p">(</span><span class="n">pseudo1</span><span class="o">=-</span><span class="n">real_pos</span><span class="o">.</span><span class="n">real1</span><span class="p">,</span>
                                    <span class="n">pseudo2</span><span class="o">=-</span><span class="n">real_pos</span><span class="o">.</span><span class="n">real2</span><span class="p">,</span>
                                    <span class="n">pseudo3</span><span class="o">=-</span><span class="n">real_pos</span><span class="o">.</span><span class="n">real3</span><span class="p">)</span>


<span class="n">p3</span> <span class="o">=</span> <span class="n">SPseudo3x3</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p3&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span>

<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">,</span> <span class="n">p3</span><span class="p">],</span> <span class="n">p3</span><span class="o">.</span><span class="n">pseudo2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 2     Time: 2020-07-04 20:37:22
Persistent Unique Scan ID: &#39;b8da8036-9e3b-46c5-9879-53f63f3a39a6&#39;
New stream: &#39;primary&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "d62586060151485c8a94bc27c7e536e3"}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
+-----------+------------+------------+------------+------------+------------+
|   seq_num |       time | p3_pseudo2 | p3_pseudo1 | p3_pseudo3 |        det |
+-----------+------------+------------+------------+------------+------------+
|         1 | 20:37:23.1 |     -1.000 |     -0.000 |     -0.000 |      1.000 |
|         2 | 20:37:23.1 |     -0.500 |     -0.000 |     -0.000 |      1.000 |
|         3 | 20:37:23.2 |      0.000 |     -0.000 |     -0.000 |      1.000 |
|         4 | 20:37:23.2 |      0.500 |     -0.000 |     -0.000 |      1.000 |
|         5 | 20:37:23.2 |      1.000 |     -0.000 |     -0.000 |      1.000 |
+-----------+------------+------------+------------+------------+------------+
generator scan [&#39;b8da8036&#39;] (scan num: 2)



</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/virtualenv/python3.7.1/lib/python3.7/site-packages/bluesky/callbacks/fitting.py:166: RuntimeWarning: invalid value encountered in double_scalars
  for dir in range(input.ndim)]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;b8da8036-9e3b-46c5-9879-53f63f3a39a6&#39;,)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {"2117efa39ec04b50be31b577447c6899": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "d62586060151485c8a94bc27c7e536e3": {"model_name": "MPLCanvasModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_cursor": "default", "_dom_classes": [], "_figure_label": "det p3_pseudo1 p3_pseudo3 vs p3_pseudo2", "_height": 950, "_image_mode": "diff", "_message": "", "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "MPLCanvasModel", "_rubberband_height": 0, "_rubberband_width": 0, "_rubberband_x": 0, "_rubberband_y": 0, "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "MPLCanvasView", "_width": 640, "footer_visible": true, "header_visible": true, "layout": "IPY_MODEL_2117efa39ec04b50be31b577447c6899", "resizable": true, "toolbar": "IPY_MODEL_775344c5cf3443f986fd0384e5b7b4f5", "toolbar_position": "left", "toolbar_visible": true}}, "d7ad455dbb9a455897f6a3204485ca97": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "775344c5cf3443f986fd0384e5b7b4f5": {"model_name": "ToolbarModel", "model_module": "jupyter-matplotlib", "model_module_version": "^0.7.2", "state": {"_current_action": "", "_dom_classes": [], "_model_module": "jupyter-matplotlib", "_model_module_version": "^0.7.2", "_model_name": "ToolbarModel", "_view_count": null, "_view_module": "jupyter-matplotlib", "_view_module_version": "^0.7.2", "_view_name": "ToolbarView", "button_style": "", "collapsed": true, "layout": "IPY_MODEL_d7ad455dbb9a455897f6a3204485ca97", "orientation": "vertical", "toolitems": [["Home", "Reset original view", "home", "home"], ["Back", "Back to previous view", "arrow-left", "back"], ["Forward", "Forward to next view", "arrow-right", "forward"], ["Pan", "Pan axes with left mouse, zoom with right", "arrows", "pan"], ["Zoom", "Zoom to rectangle", "square-o", "zoom"], ["Download", "Download plot", "floppy-o", "save_figure"]]}}}, "version_major": 2, "version_minor": 0}
</script></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Flyer Basics.html" class="btn btn-neutral float-right" title="Flyer Basics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Epics Signal.html" class="btn btn-neutral float-left" title="Epics Signal" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Bluesky Contributors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>